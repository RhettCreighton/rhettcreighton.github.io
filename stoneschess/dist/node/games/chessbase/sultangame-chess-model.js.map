{"version":3,"names":[],"mappings":"","sources":["sultangame-model.js"],"sourcesContent":["/*\n * Copyright(c) 2013-2014 - jocly.com\n *\n * You are allowed to use and modify this source code as long as it is exclusively for use in the Jocly API. \n *\n * Original authors: Jocly team\n *\n */\n \n\n \n\n(function() {\n\t\n\tvar geometry = Model.Game.cbBoardGeometryGrid(11,11);\n\nfunction IIPawnGraph(aGame,side) {\n\t\treturn aGame.cbMergeGraphs(geometry,\n\t\t\t\taGame.cbLongRangeGraph(geometry,[[0,side]],null,aGame.cbConstants.FLAG_MOVE,3), \n\t\t\t\taGame.cbShortRangeGraph(geometry,[[-1,side],[1,side]],null,aGame.cbConstants.FLAG_CAPTURE)\n\t\t\t);\n\t}\n\n\t\n\tModel.Game.cbDefine = function() {\n\t\t\n\t\treturn {\n\t\t\t\n\t\t\tgeometry: geometry,\n\t\t\t\n\t\t\tpieceTypes: {\n\n\t\t\t\t0: {\n\t\t\t\t\tname: 'pawn-w',\n\t\t\t\t\taspect: 'fr-pawn',\n\t\t\t\t\tgraph: this.cbPawnGraph(geometry,1),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tepCatch: true,\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t1: {\n\t\t\t\t\tname: 'ipawn-w',\n\t\t\t\t\taspect: 'fr-pawn',\n\t\t\t\t\tgraph: this.cbInitialPawnGraph(geometry,1),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tepTarget: true,\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t2: {\n\t\t\t\t\tname: 'pawn-b',\n\t\t\t\t\taspect: 'fr-pawn',\n\t\t\t\t\tgraph: this.cbPawnGraph(geometry,-1),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tepCatch: true,\n\t\t\t\t},\n\n\t\t\t\t3: {\n\t\t\t\t\tname: 'ipawn-b',\n\t\t\t\t\taspect: 'fr-pawn',\n\t\t\t\t\tgraph: this.cbInitialPawnGraph(geometry,-1),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tepTarget: true,\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t4: {\n\t\t\t\t\tname: 'knight',\n\t\t\t\t\taspect: 'fr-knight',\n\t\t\t\t\tgraph: this.cbKnightGraph(geometry),\n\t\t\t\t\tvalue: 2.9,\n\t\t\t\t\tabbrev: 'N',\n\t\t\t\t\tinitial: [{s:1,p:2},{s:1,p:9},{s:-1,p:112},{s:-1,p:119}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t5: {\n\t\t\t\t\tname: 'bishop',\n\t\t\t\t\taspect: 'fr-bishop',\n\t\t\t\t\tgraph: this.cbBishopGraph(geometry),\n\t\t\t\t\tvalue: 3.1,\n\t\t\t\t\tabbrev: 'B',\n\t\t\t\t\tinitial: [{s:1,p:1},{s:1,p:8},{s:-1,p:111},{s:-1,p:118}],\n\t\t\t\t},\n\n\t\t\t\t6: {\n\t\t\t\t\tname: 'rook',\n\t\t\t\t\taspect: 'fr-rook',\n\t\t\t\t\tgraph: this.cbRookGraph(geometry),\n\t\t\t\t\tvalue: 5,\n\t\t\t\t\tabbrev: 'R',\n\t\t\t\t\tinitial: [{s:1,p:0},{s:1,p:10},{s:-1,p:110},{s:-1,p:120}],\n\t\t\t\t\tcastle: true,\n\t\t\t\t},\n\n\t\t\t\t7: {\n\t\t\t\t\tname: 'queen',\n\t\t\t\t\taspect: 'fr-queen',\n\t\t\t\t\tgraph: this.cbQueenGraph(geometry),\n\t\t\t\t\tvalue: 9,\n\t\t\t\t\tabbrev: 'Q',\n\t\t\t\t\tinitial: [{s:1,p:6},{s:-1,p:116}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t8: {\n\t\t\t\t\tname: 'king',\n\t\t\t\t\taspect: 'fr-king',\n\t\t\t\t\tisKing: true,\n\t\t\t\t\tgraph: this.cbKingGraph(geometry),\n\t\t\t\t\tabbrev: 'K',\n\t\t\t\t\tinitial: [{s:1,p:5},{s:-1,p:115}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t9: {\n\t            \tname: 'commander',\n\t            \taspect: 'fr-amazon',\n\t\t\t\t\tgraph: this.cbMergeGraphs(geometry,\n            \t\t\tthis.cbQueenGraph(geometry),\n\t\t\t\t\t\tthis.cbKnightGraph(geometry)),\n\t            \tvalue: 12,\n\t            \tabbrev: 'C',\n\t            \tinitial: [{s:1,p:4},{s:-1,p:114}],\n\t            },\t\n\t\t\t\t\t\t\t\n\t            10: {\n\t            \tname: 'adjutant',\n\t            \taspect: 'fr-cardinal',\n\t\t\t\t\tgraph: this.cbMergeGraphs(geometry,\n            \t\t\tthis.cbBishopGraph(geometry),\n\t\t\t\t\t\tthis.cbKnightGraph(geometry)),\n\t            \tvalue: 6,\n\t            \tabbrev: 'A',\n\t            \tinitial: [{s:1,p:7},{s:-1,p:117}],\n\t            },\t\n\t\t\t11: {\n\t            \tname: 'marshall',\n\t            \taspect: 'fr-marshall',\n\t\t\t\t\tgraph: this.cbMergeGraphs(geometry,\n            \t\t\tthis.cbRookGraph(geometry),\n\t\t\t\t\t\tthis.cbKnightGraph(geometry)),\n\t            \tvalue: 7.5,\n\t            \tabbrev: 'M',\n\t            \tinitial: [{s:1,p:3},{s:-1,p:113}],\n\t            },\t\n\n\t\t\t12: {\n\t\t\t\t\tname: 'iipawn-w',\n\t\t\t\t\taspect: 'fr-pawn',\n\t\t\t\t\tgraph: IIPawnGraph(this,1),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tinitial: [{s:1,p:11},{s:1,p:12},{s:1,p:13},{s:1,p:14},{s:1,p:15},{s:1,p:16},{s:1,p:17},{s:1,p:18},{s:1,p:19},{s:1,p:20},{s:1,p:21}],\n\t\t\t\t\tepTarget: true,\n\t\t\t\t},\n\n\t\t\t\t13: {\n\t\t\t\t\tname: 'iipawn-b',\n\t\t\t\t\taspect: 'fr-pawn',\n\t\t\t\t\tgraph: IIPawnGraph(this,-1),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tinitial: [{s:-1,p:99},{s:-1,p:100},{s:-1,p:101},{s:-1,p:102},{s:-1,p:103},{s:-1,p:104},{s:-1,p:105},{s:-1,p:106},{s:-1,p:107},{s:-1,p:108},{s:-1,p:109}],\n\t\t\t\t\tepTarget: true,\n\t\t\t\t},\n\n\n\n\t\t\t\n\t\t\t},\n\t\t\t\n\t\t\tpromote: function(aGame,piece,move) {\n\t\t\t\tif(piece.t==12 || piece.t==13) {\n\t\t\t\t\t//var dc=Math.abs(geometry.C(move.t)-geometry.C(move.f));\n\t\t\t\t\tvar dr=Math.abs(geometry.R(move.t)-geometry.R(move.f));\n\t\t\t\t\tif(dr==1)\n\t\t\t\t\t\treturn [piece.t==12?1:3];\n\t\t\t\t\telse\n\t\t\t\t\t\treturn [piece.t==12?0:2];\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif(piece.t==1)\n\t\t\t\t\treturn [0];\n\t\t\t\telse if(piece.t==3)\n\t\t\t\t\treturn [2];\n\t\t\t\tvar r=geometry.R(move.t);\n\n\t\t\t\tif((piece.t==0 && geometry.R(move.t)==10) || (piece.t==2 && geometry.R(move.t)==0)) {\n\t\t\t\t\tvar considerTypes={ 4:1, 5:1, 6:1, 7:1, 9:1, 10:1, 11:1 };\n\t\t\t\t\tvar promoTypes={};\n\t\t\t\t\tfor(var i=0;i<this.pieces.length;i++) {\n\t\t\t\t\t\tvar piece1=this.pieces[i];\n\t\t\t\t\t\tif(piece1.s==piece.s // piece from our side \n\t\t\t\t\t\t\t\t&& piece1.p<0 // already captured \n\t\t\t\t\t\t\t\t&& (piece1.t in considerTypes)) // promotable piece type\n\t\t\t\t\t\t\tpromoTypes[piece1.t]=1;\n\t\t\t\t\t}\n\t\t\t\t\tvar promo=[];\n\t\t\t\t\tfor(var t in promoTypes) // create an array of types from our types map\n\t\t\t\t\t\tpromo.push(t);\n\t\t\t\t\tif(r!=0 && r!=10) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tpromo.unshift(piece.t);\n\t\t\t\t\t} else if(promo.length==0)\n\t\t\t\t\t\treturn null; // last line but no captured piece to promote to: move is not possible\n\t\t\t\t\treturn promo;\n\t\t\t\t}\n\t\t\t\treturn [];\n\t\t\t},\n\n\t\tcastle: {\n\t\t\t\t\"5/0\": {k:[4,3,2,1],r:[1,2,3,4],n:\"O-O\"},\n\t\t\t\t\"5/10\": {k:[6,7,8,9],r:[9,8,7,6],n:\"O-O-O\"},\n\t\t\t\t\"115/110\": {k:[114,113,112,111],r:[111,112,113,114],n:\"O-O\"},\n\t\t\t\t\"115/120\": {k:[116,117,118,119],r:[119,118,117,116],n:\"O-O-O\"},\n\t\t\t},\n\t\t\n\t\t};\n\t}\n\t\n})();"],"file":"sultangame-chess-model.js"}
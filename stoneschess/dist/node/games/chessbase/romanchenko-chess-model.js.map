{"version":3,"names":[],"mappings":"","sources":["romanchenko-model.js"],"sourcesContent":["\n(function() {\n\t\n\tvar geometry = Model.Game.cbBoardGeometryGrid(10,8);\n\t\n\tvar confine = {};\n\tfor(var pos=0;pos<geometry.boardSize;pos++) {\n\t\tif(!(\n\t\t\t\t(pos>=0 && pos<=1) ||\n\t\t\t\t(pos>=10 && pos<=11) ||\n\t\t\t\t(pos>=20 && pos<=21) ||\n\t\t\t\t(pos>=30 && pos<=31) || \n\t\t\t\t(pos>=48 && pos<=49) ||\n\t\t\t\t(pos>=58 && pos<=59) ||\n\t\t\t\t(pos>=68 && pos<=69) ||\n\t\t\t\t(pos>=78 && pos<=79) \n\t\t\t\t))\n\t\t\tconfine[pos]=1;\n\t}\n\t\t\n\tModel.Game.cbDefine = function() {\n\t\t\n\t\treturn {\n\t\t\t\n\t\t\tgeometry: geometry,\n\t\t\t\n\t\t\tpieceTypes: {\n\n\t\t\t\t0: {\n\t\t\t\t\tname: 'pawn-w',\n\t\t\t\t\taspect: 'pawn',\n\t\t\t\t\tgraph: this.cbPawnGraph(geometry,1,confine),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tepCatch: true,\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t1: {\n\t\t\t\t\tname: 'ipawn-w',\n\t\t\t\t\taspect: 'pawn',\n\t\t\t\t\tgraph: this.cbInitialPawnGraph(geometry,1,confine),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tinitial: [{s:1,p:12},{s:1,p:13},{s:1,p:14},{s:1,p:15},{s:1,p:16},{s:1,p:17},{s:1,p:18},{s:1,p:19}],\n\t\t\t\t\tepCatch: true,\n\t\t\t\t\tepTarget: true,\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t2: {\n\t\t\t\t\tname: 'pawn-b',\n\t\t\t\t\taspect: 'pawn',\n\t\t\t\t\tgraph: this.cbPawnGraph(geometry,-1,confine),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tepCatch: true,\n\t\t\t\t},\n\n\t\t\t\t3: {\n\t\t\t\t\tname: 'ipawn-b',\n\t\t\t\t\taspect: 'pawn',\n\t\t\t\t\tgraph: this.cbInitialPawnGraph(geometry,-1,confine),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tinitial: [{s:-1,p:60},{s:-1,p:61},{s:-1,p:62},{s:-1,p:63},{s:-1,p:64},{s:-1,p:65},{s:-1,p:66},{s:-1,p:67}],\n\t\t\t\t\tepCatch: true,\n\t\t\t\t\tepTarget: true,\n\t\t\t\t},\n\n\t\t\t\t4: {\n\t\t\t\t\tname: 'knight',\n\t\t\t\t\tgraph: this.cbKnightGraph(geometry,confine),\n\t\t\t\t\tvalue: 2.9,\n\t\t\t\t\tabbrev: 'N',\n\t\t\t\t\tinitial: [{s:1,p:3},{s:1,p:8},{s:-1,p:71},{s:-1,p:76}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t5: {\n\t\t\t\t\tname: 'bishop',\n\t\t\t\t\tgraph: this.cbBishopGraph(geometry,confine),\n\t\t\t\t\tvalue: 3.1,\n\t\t\t\t\tabbrev: 'B',\n\t\t\t\t\tinitial: [{s:1,p:4},{s:1,p:7},{s:-1,p:72},{s:-1,p:75}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t6: {\n\t\t\t\t\tname: 'rook',\n\t\t\t\t\tgraph: this.cbRookGraph(geometry,confine),\n\t\t\t\t\tvalue: 5,\n\t\t\t\t\tabbrev: 'R',\n\t\t\t\t\tinitial: [{s:1,p:2},{s:1,p:9},{s:-1,p:70},{s:-1,p:77}],\n\t\t\t\t\tcastle: true,\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t7: {\n\t\t\t\t\tname: 'queen',\n\t\t\t\t\tgraph: this.cbQueenGraph(geometry,confine),\n\t\t\t\t\tinitial: [{s:1,p:5},{s:-1,p:74}],\n\t\t\t\t\tabbrev: 'Q',\n\t\t\t\t},\n\n\t\t\t\t8: {\n\t\t\t\t\tname: 'king',\n\t\t\t\t\tisKing: true,\n\t\t\t\t\tgraph: this.cbKingGraph(geometry,confine),\n\t\t\t\t\tabbrev: 'K',\n\t\t\t\t\tinitial: [{s:1,p:6},{s:-1,p:73}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t},\n\t\t\t\n\t\t\tpromote: function(aGame,piece,move) {\n\t\t\t\tif(piece.t==1)\n\t\t\t\t\treturn [0];\n\t\t\t\telse if(piece.t==3)\n\t\t\t\t\treturn [2];\n\t\t\t\telse if(piece.t==0 && geometry.R(move.t)==7)\n\t\t\t\t\treturn [4,5,6,7];\n\t\t\t\telse if(piece.t==2 && geometry.R(move.t)==0)\n\t\t\t\t\treturn [4,5,6,7];\n\t\t\t\treturn [];\n\t\t\t},\n\n\t\t\tcastle: {\n\t\t\t\t\"6/2\": {k:[5,4],r:[3,4,5],n:\"O-O-O\"},\n\t\t\t\t\"6/9\": {k:[7,8],r:[8,7],n:\"O-O\"},\n\t\t\t\t\"73/77\": {k:[74,75],r:[76,75,74],n:\"O-O-O\"},\n\t\t\t\t\"73/70\": {k:[72,71],r:[71,72],n:\"O-O\"},\n\t\t\t},\n\t\t\t\n\t\t\tevaluate: function(aGame,evalValues,material) {\n\t\t\t\t// check lack of material to checkmate\n\t\t\t\tvar white=material[1].count;\n\t\t\t\tvar black=material[-1].count;\n\t\t\t\tif(!white[0] && !white[1] && !white[4] && !white[5] && !white[6] && !white[7]) { // white king single\n\t\t\t\t\tif(!black[2] && !black[3] && !black[6] && !black[7] && (black[4]+black[5]<2 || black[5]<2)) {\n\t\t\t\t\t\tthis.mFinished=true;\n\t\t\t\t\t\tthis.mWinner=JocGame.DRAW;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(!black[2] && !black[3] && !black[4] && !black[5] && !black[6] && !black[7]) { // black king single\n\t\t\t\t\tif(!white[0] && !white[1] && !white[6] && !white[7] && (white[4]+white[5]<2 || white[5]<2)) {\n\t\t\t\t\t\tthis.mFinished=true;\n\t\t\t\t\t\tthis.mWinner=JocGame.DRAW;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// check 50 moves without capture\n\t\t\t\tif(this.noCaptCount>=100) {\n\t\t\t\t\tthis.mFinished=true;\n\t\t\t\t\tthis.mWinner=JocGame.DRAW;\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// motivate pawns to reach the promotion line\n\t\t\t\tvar distPromo=aGame.cbUseTypedArrays?new Int8Array(3):[0,0,0];\n\t\t\t\tvar height=geometry.height;\n\t\t\t\tvar pawns=material[1].byType[0],pawnsLength;\n\t\t\t\tif(pawns) {\n\t\t\t\t\tpawnsLength=pawns.length;\n\t\t\t\t\tfor(var i=0;i<pawnsLength;i++)\n\t\t\t\t\t\tswitch(height-geometry.R(pawns[i].p)) {\n\t\t\t\t\t\tcase 2: distPromo[0]++; break;\n\t\t\t\t\t\tcase 3: distPromo[1]++; break;\n\t\t\t\t\t\tcase 4: distPromo[2]++; break;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tpawns=material[-1].byType[2],pawnsLength;\n\t\t\t\tif(pawns) {\n\t\t\t\t\tpawnsLength=pawns.length;\n\t\t\t\t\tfor(var i=0;i<pawnsLength;i++)\n\t\t\t\t\t\tswitch(geometry.R(pawns[i].p)) {\n\t\t\t\t\t\tcase 1: distPromo[0]--; break;\n\t\t\t\t\t\tcase 2: distPromo[1]--; break;\n\t\t\t\t\t\tcase 3: distPromo[2]--; break;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(distPromo[0]!=0)\n\t\t\t\t\tevalValues['distPawnPromo1']=distPromo[0];\n\t\t\t\tif(distPromo[1]!=0)\n\t\t\t\t\tevalValues['distPawnPromo2']=distPromo[1];\n\t\t\t\tif(distPromo[2]!=0)\n\t\t\t\t\tevalValues['distPawnPromo3']=distPromo[2];\n\t\t\t\t\n\t\t\t\t// motivate knights and bishops to deploy early\n\t\t\t\tvar minorPiecesMoved=0;\n\t\t\t\tfor(var t=4;t<=5;t++)\n\t\t\t\t\tfor(var s=1;s>=-1;s-=2) {\n\t\t\t\t\t\tvar pieces=material[s].byType[t];\n\t\t\t\t\t\tif(pieces)\n\t\t\t\t\t\t\tfor(var i=0;i<pieces.length;i++)\n\t\t\t\t\t\t\t\tif(pieces[i].m)\n\t\t\t\t\t\t\t\t\tminorPiecesMoved+=s;\n\t\t\t\t\t}\n\t\t\t\tif(minorPiecesMoved!=0) {\n\t\t\t\t\tevalValues['minorPiecesMoved']=minorPiecesMoved;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t};\n\t}\n\t\n})();"],"file":"romanchenko-chess-model.js"}
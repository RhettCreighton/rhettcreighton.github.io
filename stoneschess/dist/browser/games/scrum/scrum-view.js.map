{"version":3,"names":[],"mappings":"","sources":["scrum-xd-view.js"],"sourcesContent":["/*\n *\n * Copyright (c) 2013 - Jocly - www.jocly.com\n * \n * This file is part of the Jocly game platform and cannot be used outside of this context without the written permission of Jocly.\n * \n */\n\n(function() {\n\t\n\tvar HEIGHT=12600, WIDTH=5250;\n\tvar BWIDTH,BHEIGHT;\n\tvar cellSide;\n\tvar nbStadiumLights=0;\n\tvar stadiumScale=1.3;\n\tvar stadiumZ=-210;\n\tvar groundZoom=stadiumScale*0.8;\n\tvar followBall=true;\n\t\n\n\tView.Game.xdInit = function(xdv) {\n\n\t\tvar fullPath=this.mViewOptions.fullPath;\n\n\t\tBWIDTH=this.mOptions.width;\n\t\tBHEIGHT=this.mOptions.height;\n\n\t\txdv.createGadget(\"board\", {\n\t\t\t\"2d\" : {\n\t\t\t\ttype : \"canvas\",\n\t\t\t},\n\t\t});\n\t\tfor (var l=0;l<nbStadiumLights;l++){\n\t\t\tvar r=5000;\n\t\t\tvar angle=Math.PI/4+(2*Math.PI/nbStadiumLights)*l;\n\t\t\txdv.createGadget(\"slight#\"+l, {\n\t\t\t\t\"3d\": {\n\t\t\t\t\ttype: \"custom3d\",\n\t\t\t\t\tcreate: function() {\n\t\t\t\t\t\tvar light = new THREE.SpotLight( 0xffffff, 0.7 );\n\t\t\t\t\t\tlight.castShadow = true;\n\t\t\t\t\t\t//light.shadowCameraVisible=true;\n\t\t\t\t\t\tlight.shadowDarkness = .25;\n\t\t\n\t\t\t\t\t\tlight.shadowCameraNear = 3;\n\t\t\t\t\t\tlight.shadowCameraFar = 20;\n\t\t\t\t\t\tlight.shadowCameraFov = 90;\n\t\t\t\t\t\tlight.shadowMapWidth = 1024;\n\t\t\t\t\t\tlight.shadowMapHeight = 1024;\n\t\t\t\t\t\t\n\t\t\t\t\t\tlight.shadowCascade = true;\n\t\t\t\t\t\tlight.shadowCascadeCount = 3;\n\t\t\t\t\t\tlight.shadowCascadeNearZ = [ -1.000, 0.995, 0.998 ];\n\t\t\t\t\t\tlight.shadowCascadeFarZ  = [  0.995, 0.998, 1.000 ];\n\t\t\t\t\t\tlight.shadowCascadeWidth = [ 1024, 1024, 1024 ];\n\t\t\t\t\t\tlight.shadowCascadeHeight = [ 1024, 1024, 1024 ];\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn light;\n\t\t\t\t\t},\n\t\t\t\t\ty: r*Math.sin(angle),\n\t\t\t\t\tx: r*Math.cos(angle),\n\t\t\t\t\tz: 6000,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\txdv.createGadget(\"boardgrass\",{\n\t\t\t\"2d\":{\n\t\t\t\ttype:\"sprite\",\n\t\t\t\tfile : fullPath + \"/res/xd-view/meshes/scrumfield8x12.jpg\",\n\t\t\t\tclipwidth : 700,\n\t\t\t\tclipheight : 1200,\n\t\t\t\tclipx : 50,\n\t\t\t\tclipy : 48,\n\t\t\t\tz: -1,\n\t\t\t\t//opacity:0.5,\t\t\t\t\n\t\t\t}\n\t\t});\n\t\t\n\t\tfor(var ad=0;ad<2;ad++){\n\t\t\txdv.createGadget(\"field-ad#\"+ad,{\n\t\t\t\t\"2d\": {\n\t\t\t\t\tclipwidth : 300,\n\t\t\t\t\tclipheight : 100,\n\t\t\t\t\tclipx : 0,\n\t\t\t\t\tclipy : 0,\n\t\t\t\t\tz: 5,\n\t\t\t\t\topacity:0.5,\t\t\t\t\t\n\t\t\t\t},\n\t\t\t\t\"regular\":{\n\t\t\t\t\ttype : \"sprite\",\n\t\t\t\t\tfile : fullPath + \"/res/xd-view/meshes/field-ad.jocly.jpg\",\n\t\t\t\t},\n\t\t\t\t\"regularsg\":{\n\t\t\t\t\ttype : \"sprite\",\n\t\t\t\t\tfile : fullPath + \"/res/xd-view/meshes/field-ad.sg.jpg\",\n\t\t\t\t},\n\t\t\t\t\"regularhnk\":{\n\t\t\t\t\ttype : \"sprite\",\n\t\t\t\t\tfile : fullPath + \"/res/xd-view/meshes/field-ad.hnk.jpg\",\n\t\t\t\t},\n\t\t\t\t\"regularlr\":{\n\t\t\t\t\ttype : \"sprite\",\n\t\t\t\t\tfile : fullPath + \"/res/xd-view/meshes/field-ad.lr.jpg\",\n\t\t\t\t},\n\t\t\t\t\"regularea\":{\n\t\t\t\t\ttype : \"sprite\",\n\t\t\t\t\tfile : fullPath + \"/res/xd-view/meshes/field-ad.ea.jpg\",\n\t\t\t\t},\n\t\t\t\t\"regularcc\":{\n\t\t\t\t\ttype : \"sprite\",\n\t\t\t\t\tfile : fullPath + \"/res/xd-view/meshes/field-ad.cc.jpg\",\n\t\t\t\t},\n\t\t\t\t\"regulartb\":{\n\t\t\t\t\ttype : \"sprite\",\n\t\t\t\t\tfile : fullPath + \"/res/xd-view/meshes/field-ad.tb.jpg\",\n\t\t\t\t},\n\t\t\t\t\"regularmc\":{\n\t\t\t\t\ttype : \"sprite\",\n\t\t\t\t\tfile : fullPath + \"/res/xd-view/meshes/field-ad.mc.jpg\",\n\t\t\t\t},\n\t\t\t\t\"regulardhl\":{\n\t\t\t\t\ttype : \"sprite\",\n\t\t\t\t\tfile : fullPath + \"/res/xd-view/meshes/field-ad.dhl.jpg\",\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\txdv.createGadget(\"screenlighta\",{\n\t\t\t\"3d\": {\n\t\t\t\ttype: \"custom3d\",\n\t\t\t\tcreate: function(){\n\t\t\t\t\tvar aLight= new THREE.SpotLight(0xffffff,1.2, 0, 1.05, 1, 2);\n\t\t\t\t\taLight.castShadow = false;\n\t\t\t\t\treturn aLight;\n\t\t\t\t},\n\t\t\t\ty: -7000,\n\t\t\t\tz:300,\n\t\t\t\trotateX:90,\n\t\t\t}\n\t\t});\n\t\txdv.createGadget(\"screenlightb\",{\n\t\t\t\"3d\": {\n\t\t\t\ttype: \"custom3d\",\n\t\t\t\tcreate: function(){\n\t\t\t\t\tvar aLight= new THREE.SpotLight(0xffffff,1.2, 0, 1.05, 1, 2);\n\t\t\t\t\t//aLight.height = 1000;\n\t\t\t\t\t//aLight.width = 1000;\n\t\t\t\t\taLight.castShadow = false;\n\t\t\t\t\treturn aLight;\n\t\t\t\t},\n\t\t\t\ty: 7000,\n\t\t\t\tz:300,\n\t\t\t\trotateX:90,\n\t\t\t}\n\t\t});\n\t\txdv.createGadget(\"stadium\", {\n\t\t\t\"3d\" : {\n\t\t\t\ttype: \"meshfile\",\n\t\t\t\tfile : fullPath+\"/res/xd-view/meshes/stade4.js\",\n\t\t\t\tscale: [stadiumScale,stadiumScale,stadiumScale],\n\t\t\t\tflatShading:true,\n\t\t\t\tz: stadiumZ,\n\t\t\t\tsmooth:0,\n\t\t\t}\n\t\t});\n\t\txdv.createGadget(\"stadiumxtra\", {\n\t\t\t\"3d\" : {\n\t\t\t\ttype: \"meshfile\",\n\t\t\t\tfile : fullPath+\"/res/xd-view/meshes/stade2-xtra.js\",\n\t\t\t\tscale: [stadiumScale,stadiumScale,stadiumScale],\n\t\t\t\tflatShading:true,\n\t\t\t\tz: stadiumZ,\n\t\t\t\t//smooth:1,\n\t\t\t\tclick: function() {\n\t\t\t\t\tfollowBall=true;\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"scrum3djocly\": {\n\t\t\t\tmaterials:{\n\t\t\t\t\t\"mat.pub.large.panels\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.jocly.jpg\",\n\t\t\t\t\t},\n\t\t\t\t\t\"poteaux.pub\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.jocly.jpg\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}, \n\t\t\t\"scrum3dsg\": {\n\t\t\t\tmaterials:{\n\t\t\t\t\t\"mat.pub.large.panels\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.sg.jpg\",\n\t\t\t\t\t},\n\t\t\t\t\t\"poteaux.pub\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.sg.jpg\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}, \n\t\t\t\"scrum3dhnk\": {\n\t\t\t\tmaterials:{\n\t\t\t\t\t\"mat.pub.large.panels\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.hnk.jpg\",\n\t\t\t\t\t},\n\t\t\t\t\t\"poteaux.pub\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.hnk.jpg\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}, \n\t\t\t\"scrum3dlr\": {\n\t\t\t\tmaterials:{\n\t\t\t\t\t\"mat.pub.large.panels\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.lr.jpg\",\n\t\t\t\t\t},\n\t\t\t\t\t\"poteaux.pub\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.lr.jpg\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}, \n\t\t\t\"scrum3dea\": {\n\t\t\t\tmaterials:{\n\t\t\t\t\t\"mat.pub.large.panels\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.ea.jpg\",\n\t\t\t\t\t},\n\t\t\t\t\t\"poteaux.pub\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.ea.jpg\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}, \n\t\t\t\"scrum3dcc\": {\n\t\t\t\tmaterials:{\n\t\t\t\t\t\"mat.pub.large.panels\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.cc.jpg\",\n\t\t\t\t\t},\n\t\t\t\t\t\"poteaux.pub\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.cc.jpg\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}, \n\t\t\t\"scrum3dmc\": {\n\t\t\t\tmaterials:{\n\t\t\t\t\t\"mat.pub.large.panels\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.mc.jpg\",\n\t\t\t\t\t},\n\t\t\t\t\t\"poteaux.pub\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.mc.jpg\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t\"scrum3dtb\": {\n\t\t\t\tmaterials:{\n\t\t\t\t\t\"mat.pub.large.panels\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.tb.jpg\",\n\t\t\t\t\t},\n\t\t\t\t\t\"poteaux.pub\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.tb.jpg\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}, \n\t\t\t\"scrum3ddhl\": {\n\t\t\t\tmaterials:{\n\t\t\t\t\t\"mat.pub.large.panels\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.dhl.jpg\",\n\t\t\t\t\t},\n\t\t\t\t\t\"poteaux.pub\":{\n\t\t\t\t\t\tmap: fullPath+\"/res/xd-view/meshes/pubs.dhl.jpg\",\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\t\n\t\t});\n\n/*\t\txdv.createGadget(\"stadium-rows\", {\n\t\t\t\"3d\" : {\n\t\t\t\ttype: \"custommesh3d\",\n\t\t\t\tscale: [stadiumScale,stadiumScale,stadiumScale],\n\t\t\t\tz: stadiumZ,\n\t\t\t\tcreate : function(){\n\t\t\t\t\t$this = this;\n\t\t\t\t\tthis.getResource(\"smoothedfilegeo|\"+0+\"|\"+fullPath+\"/res/xd-view/meshes/stade2-rows.js\",function(geometry , materials) {\n\t\t\t\t\t\tvar nbParticules=0;\n\t\t\t\t\t\tvar colors=[];\n\t\t\t\t\t\tfunction addPeople(vrtx,color){\n\t\t\t\t\t\t\tparticles.vertices.push(vrtx);\n\t\t\t\t\t\t\tif (color){\n\t\t\t\t\t\t\t\tcolors[nbParticules]=color;\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tcolors[nbParticules]=new THREE.Color(Math.random()*0xffffff);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tnbParticules++;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar particles=new THREE.Geometry();\n\t\t\t\t\t\tfor (var f=0;f<geometry.faces.length;f++){\n\t\t\t\t\t\t\tvar centroid=geometry.faces[f].centroid;\n\t\t\t\t\t\t\tvar a=geometry.vertices[geometry.faces[f].a];\n\t\t\t\t\t\t\tvar b=geometry.vertices[geometry.faces[f].b];\n\t\t\t\t\t\t\tvar c=geometry.vertices[geometry.faces[f].c];\n\t\t\t\t\t\t\tvar d=geometry.vertices[geometry.faces[f].d];\t\t*/\n\t\t\t\t\t\t\t/*\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\td*************c\n\t\t\t\t\t\t\t***************\n\t\t\t\t\t\t\t**dp*******cp**\n\t\t\t\t\t\t\t***************\n\t\t\t\t\t\t\t***************\n\t\t\t\t\t\t\t***************\n\t\t\t\t\t\t\t***************\n\t\t\t\t\t\t\t***************\n\t\t\t\t\t\t\t**ap*******bp**\n\t\t\t\t\t\t\t***************\n\t\t\t\t\t\t\ta*************b\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t*/\n\t\t\t\t\t\t\t/*\n\t\t\t\t\t\t\tvar nbRows=16;\n\t\t\t\t\t\t\tvar nbCols=12;\n\t\t\t\t\t\t\tvar offsetRow=10; // (%)\n\t\t\t\t\t\t\tvar offsetCols=10; // (%)\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar delta=new THREE.Vector3();\n\t\t\t\t\t\t\tdelta.subVectors(b,a);\n\t\t\t\t\t\t\tvar ap=new THREE.Vector3();\n\t\t\t\t\t\t\tvar bp=new THREE.Vector3();\n\t\t\t\t\t\t\tvar cp=new THREE.Vector3();\n\t\t\t\t\t\t\tvar dp=new THREE.Vector3();\n\t\t\t\t\t\t\tdelta.subVectors(b,a);\n\t\t\t\t\t\t\tdelta.multiplyScalar(offsetCols/100);\n\t\t\t\t\t\t\tap.copy(a);\n\t\t\t\t\t\t\tap.add(delta);\n\t\t\t\t\t\t\tdelta.subVectors(a,b);\n\t\t\t\t\t\t\tdelta.multiplyScalar(offsetCols/100);\n\t\t\t\t\t\t\tbp.copy(b);\n\t\t\t\t\t\t\tbp.add(delta);\n\n\t\t\t\t\t\t\tdelta.subVectors(d,c);\n\t\t\t\t\t\t\tdelta.multiplyScalar(offsetCols/100);\n\t\t\t\t\t\t\tcp.copy(c);\n\t\t\t\t\t\t\tcp.add(delta);\n\t\t\t\t\t\t\taddPeople(cp,new THREE.Color(0x0000ff));\n\t\t\t\t\t\t\tdelta.subVectors(c,d);\n\t\t\t\t\t\t\tdelta.multiplyScalar(offsetCols/100);\n\t\t\t\t\t\t\tdp.copy(d);\n\t\t\t\t\t\t\tdp.add(delta);\n\t\t\t\t\t\t\taddPeople(dp,new THREE.Color(0x00ff00));\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tdelta.subVectors(dp,ap);\n\t\t\t\t\t\t\tdelta.multiplyScalar(offsetRow/100);\n\t\t\t\t\t\t\tap.add(delta);\n\t\t\t\t\t\t\tdelta.subVectors(ap,dp);\n\t\t\t\t\t\t\tdelta.multiplyScalar(offsetRow/100);\n\t\t\t\t\t\t\tdp.add(delta);\n\t\t\t\t\t\t\tdelta.subVectors(cp,bp);\n\t\t\t\t\t\t\tdelta.multiplyScalar(offsetRow/100);\n\t\t\t\t\t\t\tbp.add(delta);\n\t\t\t\t\t\t\tdelta.subVectors(bp,cp);\n\t\t\t\t\t\t\tdelta.multiplyScalar(offsetRow/100);\n\t\t\t\t\t\t\tcp.add(delta);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfor(var i=0;i<nbRows;i++){\n\t\t\t\t\t\t\t\tvar startLeft=new THREE.Vector3();\n\t\t\t\t\t\t\t\tvar endRight=new THREE.Vector3();\n\t\t\t\t\t\t\t\tstartLeft.copy(ap);\n\t\t\t\t\t\t\t\tdelta.subVectors(dp,ap);\n\t\t\t\t\t\t\t\tdelta.multiplyScalar(i/(nbRows-1));\n\t\t\t\t\t\t\t\tstartLeft.add(delta);\n\n\t\t\t\t\t\t\t\tendRight.copy(bp);\n\t\t\t\t\t\t\t\tdelta.subVectors(cp,bp);\n\t\t\t\t\t\t\t\tdelta.multiplyScalar(i/(nbRows-1));\n\t\t\t\t\t\t\t\tendRight.add(delta);\n\n\t\t\t\t\t\t\t\tfor (var j=0;j<nbCols;j++){\n\t\t\t\t\t\t\t\t\tdelta.subVectors(endRight,startLeft);\n\t\t\t\t\t\t\t\t\tdelta.multiplyScalar(j/(nbCols-1));\n\t\t\t\t\t\t\t\t\tvar p=new THREE.Vector3();\n\t\t\t\t\t\t\t\t\tp.copy(startLeft);\n\t\t\t\t\t\t\t\t\tp.add(delta);\n\t\t\t\t\t\t\t\t\taddPeople(p);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\t\t\t\t\t\t\t\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tparticles.colors=colors;\n\t\t\t\t\t\tvar pMaterial =\n\t\t\t\t\t\t  new THREE.ParticleBasicMaterial({\n\t\t\t\t\t\t    color: 0xFFFFFF,\n\t\t\t\t\t\t    size: 0.1,\n\t\t\t\t\t\t    map: THREE.ImageUtils.loadTexture(\n\t\t\t\t\t\t      fullPath + \"/res/xd-view/meshes/white.png\"\n\t\t\t\t\t\t    ),\n\t\t\t\t\t\t    blending: THREE.AdditiveBlending,\n\t\t\t\t\t\t    transparent: true,\n\t\t\t\t\t\t    vertexColors: true,\n\t\t\t\t\t\t  });\n\t\t\t\t\t\tvar particleSystem =\n\t\t\t\t\t\t\tnew THREE.ParticleSystem(\n\t\t\t\t\t\t\t\tparticles,\n\t\t\t\t\t\t\t\tpMaterial);\n\t\t\t\t\t\n\t\t\t\t\t\t$this.objectReady(particleSystem);\n\t\t\t\t\t\n\t\t\t\t\t});\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\t\t\t*/\n\t\t\t\n\t\tfunction createScreen(videoTexture) {\n\t\t\tvar $this=this;\n\t\t\tvar smooth=0;\n\t\t\tthis.getResource(\"smoothedfilegeo|\"+smooth+\"|\"+fullPath+\"/res/xd-view/meshes/stade-screen.js\",function(geometry , materials) {\n \t\t\t\tvar materials0=[];\n \t\t\t\t\n \t\t\t\tfor(var i=0;i<materials.length;i++){\n                    if (materials[i].name==\"mat.screen\"){\n\t \t\t\t\t\tvar mat=materials[i].clone();\n \t\t\t\t\t\tmat.map=videoTexture;\n \t\t\t\t\t\tmat.overdraw = true;\n \t\t\t\t\t\t//mat.side = THREE.DoubleSide;\n \t\t\t\t\t\tmaterials0.push(mat);\n                    }else{\n\t \t\t\t\t\tvar mat=materials[i].clone();\n\t \t\t\t\t\tmat.shading=THREE.FlatShading;\n\t \t\t\t\t\tmaterials0.push(mat);\n                    }\n \t\t\t\t}\n \t\t\t\tvar mesh = new THREE.Mesh( geometry , new THREE.MultiMaterial( materials0 ) );\n \t\t\t\t\n \t\t\t\tmesh.visible = false;\n \t\t\t\t$this.objectReady(mesh);\n\t\t\t});\n\t\t\treturn null;\n\t\t};\n\n\t\tvar scaleScreen=stadiumScale*2;\n\t\tvar zScreen=3000;\n\t\tvar yScreen=10000;\n\t\txdv.createGadget(\"videoa\",{\n\t\t\t\"3d\": {\n\t\t\t\ttype : \"video3d\",\t\t\t\t\n\t\t\t\tmakeMesh: function(videoTexture){\n\t\t\t\t\treturn createScreen.call(this,videoTexture);\n\t\t\t\t},\n\t\t\t\tz: zScreen,\n\t\t\t\ty: yScreen,\n\t\t\t\tscale: [scaleScreen,scaleScreen,scaleScreen],\n\t\t\t},\n\t\t\t\"scrum3dsg\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/sg.webm\",\n\t\t\t},\n\t\t\t\"scrum3dhnk\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/hnk.webm\",\n\t\t\t},\n\t\t\t\"scrum3dea\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/ea.webm\",\n\t\t\t},\n\t\t\t\"scrum3dcc\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/cc.webm\",\n\t\t\t},\n\t\t\t\"scrum3dlr\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/lr.webm\",\n\t\t\t},\n\t\t\t\"scrum3dtb\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/tb.webm\",\n\t\t\t},\n\t\t\t\"scrum3dmc\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/mc2.webm\",\n\t\t\t},\t\t\t\n\t\t\t\"scrum3ddhl\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/dhl.webm\",\n\t\t\t},\n\t\t});\n\t\txdv.createGadget(\"videob\",{\n\t\t\t\"3d\": {\n\t\t\t\ttype : \"video3d\",\n\t\t\t\tmakeMesh: function(videoTexture){\n\t\t\t\t\treturn createScreen.call(this,videoTexture);\n\t\t\t\t},\n\t\t\t\tz: zScreen,\n\t\t\t\ty: -yScreen,\n\t\t\t\tscale: [scaleScreen,scaleScreen,scaleScreen],\n\t\t\t},\n\t\t\t\"scrum3dsg\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/sg.webm\",\n\t\t\t},\n\t\t\t\"scrum3dhnk\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/hnk.webm\",\n\t\t\t},\n\t\t\t\"scrum3dea\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/ea.webm\",\n\t\t\t},\n\t\t\t\"scrum3dcc\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/cc.webm\",\n\t\t\t},\n\t\t\t\"scrum3dlr\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/lr.webm\",\n\t\t\t},\n\t\t\t\"scrum3dtb\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/tb.webm\",\n\t\t\t},\n\t\t\t\"scrum3dmc\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/mc2.webm\",\n\t\t\t},\t\t\t\n\t\t\t\"scrum3ddhl\": {\n\t\t\t\ttype : \"videofile3d\",\n\t\t\t\tsrc: fullPath+\"/videos/dhl.webm\",\n\t\t\t},\n\t\t});\n\t\t\t\t\n\t\t/*\n\t\txdv.createGadget(\"stadium-lights\", {\n\t\t\t\"3d\" : {\n\t\t\t\ttype: \"custommesh3d\",\n\t\t\t\tcreate: function(){\n\t\t\t\t\tvar $this=this;\n\t\t\t\t\tthis.getResource(\"smoothedfilegeo|\"+0+\"|\"+fullPath+\"/res/xd-view/meshes/stade-lights.js\",function(geometry , materials) {\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar starSprite = new THREE.ImageUtils.loadTexture( fullPath + \"/res/xd-view/meshes/star.png\" );\n\t\t\t\t\t\tvar material = new THREE.ParticleBasicMaterial( { size: 0.5, map: starSprite, blending: THREE.AdditiveBlending,  depthTest: true, transparent : true, } );\n\t\t\t\t\t\tmaterial.color.setHex( 0xffffff );\n\t\t\t\t\t\tvar lights = new THREE.ParticleSystem( geometry, material);\n\t\t\t\t\t\tvar material2 = new THREE.ParticleBasicMaterial( { size: 0.8, map: starSprite, blending: THREE.AdditiveBlending,  depthTest: true, transparent : true } );\n\t\t\t\t\t\tmaterial2.color.setHex( 0xff8888 );\n\t\t\t\t\t\tvar lights2 = new THREE.ParticleSystem( geometry, material2);\n\t\t\t\t\t\tlights2.scale.x=1.25;\n\t\t\t\t\t\tlights.add(lights2);\n\t\t\t\t\t\t$this.objectReady(lights);\n\t\t\t\t\t});\n\t\t\t\t\treturn null;\n\t\t\t\t},\n\t\t\t\tscale: [stadiumScale,stadiumScale,stadiumScale],\n\t\t\t\tz: stadiumZ+5000,\n\t\t\t}\n\t\t});*/\n\t\txdv.createGadget(\"surround\", {\n\t\t\t\"3d\" : {\n                harbor: false,\n\t\t\t\ttype: \"custom3d\",\n\t\t\t\twidth: 100000,\n\t\t\t\theight: 100000,\n\t\t\t\tdepth: 100000,\n\t\t\t\tscale: [1,1,1],\n\t\t\t\trotate: 90,\n\t\t\t\tcreate: function() {\t\n\t\t\t\t\tvar path = fullPath+\"/res/xd-view/textures/skybox/\";\n\n\t\n\t\t\t\t\tvar format = \".jpg\";\n\t\t\t\t\tvar urls = [\n\t\t\t\t\t\tpath + 'px' + format, path + 'nx' + format,\n\t\t\t\t\t\tpath + 'py' + format, path + 'ny' + format,\n\t\t\t\t\t\tpath + 'pz' + format, path + 'nz' + format\n\t\t\t\t\t];\n\t\t\t\t\t\n\t\t\t\t\tvar textureCube = new THREE.CubeTextureLoader().load( urls );\n\t\t\t\t\tvar material = new THREE.MeshBasicMaterial( { color: 0xffffff, envMap: textureCube, refractionRatio: 0.95 } );\n\t\t\t\t\tvar shader = {\n\t\t\t\t\t\tuniforms: { \"tCube\": { type: \"t\", value: null },\n\t\t\t\t\t\t\t\t\t\"tFlip\": { type: \"f\", value: -1 } },\n\t\t\t\t\t\tvertexShader: [\n\t\t\t\t\t\t\t\"varying vec3 vViewPosition;\",\n\t\t\t\t\t\t\t\"void main() {\",\n\t\t\t\t\t\t\t\t\"vec4 mPosition = modelMatrix * vec4( position, 1.0 );\",\n\t\t\t\t\t\t\t\t\"vViewPosition = cameraPosition - mPosition.xyz;\",\n\t\t\t\t\t\t\t\t\"gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\",\n\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t].join(\"\\n\"),\n\t\t\t\n\t\t\t\t\t\tfragmentShader: [\n\t\t\t\t\t\t\t\"uniform samplerCube tCube;\",\n\t\t\t\t\t\t\t\"uniform float tFlip;\",\n\t\t\t\t\t\t\t\"varying vec3 vViewPosition;\",\n\t\t\t\t\t\t\t\"void main() {\",\n\t\t\t\t\t\t\t\t\"vec3 wPos = cameraPosition - vViewPosition;\",\n\t\t\t\t\t\t\t\t\"gl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\",\n\t\t\t\t\t\t\t\"}\"\n\t\t\t\t\t\t].join(\"\\n\")\n\t\t\t\t\t}\n\t\t\t\t\tshader.uniforms[ \"tCube\" ].value = textureCube;\n\t\n\t\t\t\t\tvar material = new THREE.ShaderMaterial( {\n\t\n\t\t\t\t\t\tfragmentShader: shader.fragmentShader,\n\t\t\t\t\t\tvertexShader: shader.vertexShader,\n\t\t\t\t\t\tuniforms: shader.uniforms,\n\t\t\t\t\t\tdepthWrite: false,\n\t\t\t\t\t\tside: THREE.BackSide\n\t\n\t\t\t\t\t} ),\n\t\n\t\t\t\t\tmesh = new THREE.Mesh( new THREE.CubeGeometry( 3000, 3000, 3000 ), material );\n\t\t\t\t\treturn mesh;\n\t\t\t\t},\t\t\t\n\t\t\t},\n\t\t});\n\t\txdv.createGadget(\"ocean\", {\n\t\t\t\"3d\" : {\n                harbor: false,\n\t\t\t\ttype : \"meshfile\",\n\t\t\t\tfile : fullPath+\"/res/xd-view/meshes/ocean.js\",\n\t\t\t\tscale: [200,200,3],\n\t\t\t\tz : -50,\n\t\t\t\tsmooth: 0 ,\n\t\t\t},\n\t\t});\n\n\t\txdv.createGadget(\"ground\", {\n\t\t\t\"3d\" : {\n\t\t\t\ttype : \"custommesh3d\",\n\t\t\t\tz: -40,\n\t\t\t\tcreate: function(){\n\t\t\t\t\tvar gg=new THREE.CubeGeometry(8,0.08,13);\n                    var $this = this;\n                    var loader = new THREE.TextureLoader();\n                    loader.load(fullPath+\"/res/xd-view/meshes/scrumfield8x12-3d.jpg\",\n                        function(diffuseMap) {\n                            diffuseMap.wrapS = diffuseMap.wrapT = THREE.RepeatWrapping;\n                            diffuseMap.format = THREE.RGBFormat;\n                            //var gm=new THREE.MeshBasicMaterial({color:0xffffff,side: THREE.DoubleSide});\n                            var gm=new THREE.MeshPhongMaterial( {\n                                        color: 0x888888,\n                                        map: diffuseMap,\n                                        shininess:0,\n                             } );\n                            var mesh=new THREE.Mesh(gg,gm);\n                            $this.objectReady(mesh);\n                        });\n\t\t\t\t\treturn null;\n\t\t\t\t},\n\t\t\t\treceiveShadow : true,\n\t\t\t\tscale: [groundZoom,groundZoom,groundZoom],\n\t\t\t},\n\t\t});\n\n\t\tfor(var pos=0;pos<BHEIGHT*BWIDTH;pos++) {\n\t\t\tvar coord=this.getVCoord(pos);\n\t\t\t(function(pos) {\n\t\t\t\txdv.createGadget(\"cell#\"+pos, {\n\t\t\t\t\t\"2d\" : {\n\t\t\t\t\t\ttype : \"element\",\n\t\t\t\t\t\tinitialClasses: ((Math.floor(pos/BWIDTH))+(pos%BWIDTH))%2?\"cell-white cell-white-rugby\":\"cell-black cell-black-rugby\",\n\t\t\t\t\t\tz: 1,\n\t\t\t\t\t},\n\t\t\t\t\t\"3d\" : {\n\t\t\t\t\t\ttype: \"meshfile\",\n\t\t\t\t\t\tfile : fullPath+\"/res/xd-view/meshes/target.js\",\n\t\t\t\t\t\tflatShading: true,\n\t\t\t\t\t\tsmooth : 0,\n\t\t\t\t\t\tz : -50,\n\t\t\t\t\t\tcastShadow: false,\n\t\t\t\t\t\tscale: [0.5,0.5,0.5],\n\t\t\t\t\t\tmaterials: { \n\t\t\t\t\t\t\t\"square\" : {\n\t\t\t\t\t\t\t\ttransparent: true,\n\t\t\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"ring\" : {\n\t\t\t\t\t\t\t\tcolor : 0xffffff,\n\t\t\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t\t\t\ttransparent: true,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\t\t\t\t\t\t\t\n\t\t\t\t\t\tholdClick: function(eventData) {\n\t\t\t\t\t\t\tfollowBall=false;\n\t\t\t\t\t\t\tvar point=eventData.point;\n\t\t\t\t\t\t\txdv.updateGadget(\"camera\",{\n\t\t\t\t\t\t\t\t\"3d\": {\n\t\t\t\t\t\t\t\t\ttargetX: 0,\n\t\t\t\t\t\t\t\t\ttargetY: point.z/$this.SCALE3D,\n\t\t\t\t\t\t\t\t\t//targetZ: point.y/$this.SCALE3D,\n\t\t\t\t\t\t\t\t\ttraveling: true,\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},1000);\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t});\t\t\t\t\n\t\t\t\txdv.createGadget(\"text#\"+pos, {\n\t\t\t\t\t\"2d\" : {\n\t\t\t\t\t\ttype : \"element\",\n\t\t\t\t\t\tinitialClasses: \"xd-notation\",\n\t\t\t\t\t\tdisplay : function(element, width, height) {\n\t\t\t\t\t\t\telement.css({\n\t\t\t\t\t\t\t\t\"font-size\" : (height * .6) + \"pt\",\n\t\t\t\t\t\t\t\t\"line-height\" : (height * 1) + \"px\",\n\t\t\t\t\t\t\t}).text(pos);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t\"3d\": {\n\t\t\t\t\t\ttype: \"custommesh3d\",\n\t\t\t\t\t\t//z: -cellSide*.05,\n\t\t\t\t\t\trotateX: -90,\n\t\t\t\t\t\tcreate: function() {\n                            var $this = this;\n                            this.getResource('font|'+fullPath+\n                                '/res/xd-view/fonts/helvetiker_regular.typeface.json',\n                                function(font) {\n                                var gg=new THREE.TextGeometry(\"\"+(pos+1),{\n                                    size: 0.2,\n                                    height: 0.05,\n                                    curveSegments: 6,\n                                    font: font,\n\n                                });\n                                var gm=new THREE.MeshPhongMaterial();\n                                var mesh= new THREE.Mesh( gg , gm );\n                                $this.objectReady(mesh);\n                            });\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tcolor: 0x888888,\n\t\t\t\t\t},\n\t\t\t\t});\t\t\t\n\t\t\t})(pos);\n\t\t}\n\t\t\n\t\tvar initial=this.mOptions.initial;\n\t\tvar pieceIndex=0;\n\t\tvar pieceZoom=0.16;\n\t\tfunction CreatePiece(side) {\n\t\t\txdv.createGadget(\"player#\"+(pieceIndex++), {\n\t\t\t\t\"2d\" : {\n\t\t\t\t\ttype : \"sprite\",\n\t\t\t\t\tz: 4,\n\t\t\t\t\tfile : fullPath + \"/res/images/regular.png\",\n\t\t\t\t\tclipwidth : 125,\n\t\t\t\t\tclipheight : 125,\n\t\t\t\t\tclipx : side==JocGame.PLAYER_A?125:0,\n\t\t\t\t\tclipy : 0,\n\t\t\t\t},\n\t\t\t\t\"3d\" : {\n\t\t\t\t\ttype: \"meshfile\",\n\t\t\t\t\t//file : fullPath+\"/res/xd-view/meshes/scrumer-team-a.js\",\n\t\t\t\t\tfile : fullPath+\"/res/xd-view/meshes/player-anim.js\",\n\t\t\t\t\tscale: [pieceZoom,pieceZoom,pieceZoom],\n\t\t\t\t\t//flatShading: true,\n\t\t\t\t\t//smooth : 2,\n\t\t\t\t\tz : 30,\t\t\n\t\t\t\t\tmaterials:{\n\t\t\t\t\t\t\"mat.short\":{\n\t\t\t\t\t\t\tmap: side==JocGame.PLAYER_A?fullPath+\"/res/xd-view/meshes/teama-text.jpg\":fullPath+\"/res/xd-view/meshes/teamb-text.jpg\",\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tmorphing: [1,0,0,0,0,0,0,0,0,0,0,0],\n\t\t\t\t},\t\n\t\t\t});\t\t\t\t\t\t\t\n\t\t}\n\t\tfor(var i=0;i<initial.a.length;i++)\n\t\t\tCreatePiece(JocGame.PLAYER_A);\n\t\tfor(var i=0;i<initial.b.length;i++)\n\t\t\tCreatePiece(JocGame.PLAYER_B);\n\t\txdv.createGadget(\"ball\", {\n\t\t\t\"2d\" : {\n\t\t\t\ttype : \"sprite\",\n\t\t\t\tz: 4,\n\t\t\t\tfile : this.mViewOptions.fullPath + \"/res/images/regular.png\",\n\t\t\t\tclipwidth : 125,\n\t\t\t\tclipheight : 125,\n\t\t\t\tclipx : 250,\n\t\t\t\tclipy : 0,\n\t\t\t},\n            \"3d\" : {\n                type: \"meshfile\",\n                file : fullPath+\"/res/xd-view/meshes/scrum-ball.js\",\n                scale: [0.2,0.2,0.2],\n                smooth: 0,\n                z: 500,  \n                rotate : 45,        \n                rotateX: 45,    \n                materials:{\n                \t\"Material\":{\n                \t\tshininess:10,\n                \t\tspecular:{r:.1,g:.1,b:.1},\n                \t}\n                }\n            },\n\t\t});\n\t\txdv.createGadget(\"arrowscrum\", {\n\t\t\t\"2d\" : {\n\t\t\t\ttype : \"sprite\",\n\t\t\t\tz: 4,\n\t\t\t\twidth: 400,\n\t\t\t\theight: 400,\n\t\t\t\tfile : this.mViewOptions.fullPath + \"/res/images/regular.png\",\n\t\t\t\tclipwidth : 125,\n\t\t\t\tclipheight : 125,\n\t\t\t\tclipx : 500,\n\t\t\t\tclipy : 0,\n\t\t\t},\n\t\t\t\"3d\" : {\n\t\t\t\ttype: \"meshfile\",\n\t\t\t\tfile : fullPath+\"/res/xd-view/meshes/arrowscrum.js\",\n\t\t\t\tflatShading:true,\n\t\t\t\tz: 250, //stadiumZ,\n\t\t\t},\n\t\t});\t\t\t\t\t\t\t\n\t\tfor(var i=0;i<8;i++)\n\t\t\txdv.createGadget(\"arrow#\"+i, {\n\t\t\t\t\"2d\" : {\n\t\t\t\t\ttype : \"sprite\",\n\t\t\t\t\tz: 4,\n\t\t\t\t\twidth: 400,\n\t\t\t\t\theight: 400,\n\t\t\t\t\tfile : this.mViewOptions.fullPath + \"/res/images/regular.png\",\n\t\t\t\t\tclipwidth : 125,\n\t\t\t\t\tclipheight : 125,\n\t\t\t\t\tclipx : 375,\n\t\t\t\t\tclipy : 0,\n\t\t\t\t},\n\t\t\t\t\"3d\" : {\n\t\t\t\t\ttype: \"meshfile\",\n\t\t\t\t\tfile : fullPath+\"/res/xd-view/meshes/arrow.js\",\n\t\t\t\t\tflatShading:true,\n\t\t\t\t\tz: 250, //stadiumZ,\n\t\t\t\t},\n\t\t\t});\t\t\t\t\t\t\t\n\t\t\t\n\t}\n\t\n\tView.Game.getVCoord = function(pos) {\n\t\tif(this.mViewAs==JocGame.PLAYER_B)\n\t\t\tpos=BWIDTH*BHEIGHT-1-pos;\n\t\tvar r=BHEIGHT-1-Math.floor(pos/BWIDTH);\n\t\tvar c=pos%BWIDTH;\n\t\tvar x=cellSide*(c+.5)-WIDTH/2;\n\t\tvar y=cellSide*(r+.5)-HEIGHT/2;\n\t\treturn [x,y];\n\t}\n\n\tView.Game.xdBuildScene = function(xdv) {\n\t\tvar $this=this;\n\n\t\tcellSide=Math.min(WIDTH/BWIDTH,HEIGHT/BHEIGHT);\n\t\t\n\t\tfor (var l=0;l<nbStadiumLights;l++){\n\t\t\txdv.updateGadget(\"slight#\"+l, {\n\t\t\t\t\"3d\" : {\n\t\t\t\t\tvisible: true,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\txdv.updateGadget(\"stadium\",{\n\t\t\t\"3d\" : {\n\t\t\t\tvisible: false,\n\t\t\t}\n\t\t});\n\t\txdv.updateGadget(\"stadiumxtra\",{\n\t\t\t\"3d\" : {\n\t\t\t\tvisible: true,\n\t\t\t}\n\t\t});\n\t\t/*\n\t\txdv.updateGadget(\"stadium-rows\",{\n\t\t\t\"3d\" : {\n\t\t\t\tvisible: true,\n\t\t\t}\n\t\t});\n\t\t*/\n\t\t\n\t\t/*\n\t\txdv.updateGadget(\"stadium-lights\",{\n\t\t\t\"3d\" : {\n\t\t\t\tvisible: true,\n\t\t});\t\t\n\t\t*/\n\t\txdv.updateGadget(\"screenlighta\",{\n\t\t\t\"3d\" : {\n\t\t\t\tvisible: true,\n\t\t\t}\n\t\t});\n\t\txdv.updateGadget(\"screenlightb\",{\n\t\t\t\"3d\" : {\n\t\t\t\tvisible: true,\n\t\t\t}\n\t\t});\n\t\txdv.updateGadget(\"pubvideoa\",{\n\t\t\t\"3d\" : {\n\t\t\t\tvisible: true,\n\t\t\t}\n\t\t});\t\t\n\t\txdv.updateGadget(\"pubvideob\",{\n\t\t\t\"3d\" : {\n\t\t\t\tvisible: true,\n\t\t\t}\n\t\t});\n\t\t\n\t\t\n\t\txdv.updateGadget(\"surround\",{\n\t\t\t\"3d\": {\n\t\t\t\tvisible: true,\n\t\t\t},\n\t\t});\n\t\txdv.updateGadget(\"ocean\",{\n\t\t\t\"3d\": {\n\t\t\t\tvisible: true,\n\t\t\t},\n\t\t});\n\t\txdv.updateGadget(\"ground\",{\n\t\t\t\"3d\" : {\n\t\t\t\tvisible: true,\n\t\t\t}\n\t\t});\n\t\t\n\t\txdv.updateGadget(\"boardgrass\",{\n\t\t\t\"2d\" : {\n\t\t\t\tvisible: true,\n\t\t\t\twidth: WIDTH+2*cellSide,\n\t\t\t\theight: HEIGHT,\n\t\t\t}\t\t\t\n\t\t});\n\t\txdv.updateGadget(\"board\",{\n\t\t\t\"2d\" : {\n\t\t\t\tvisible: true,\n\t\t\t\tdraw: function(ctx,pixSize) {\n\t\t\t\t\t$this.scrumDrawBoard2(ctx,pixSize,WIDTH+2*cellSide,HEIGHT,2);\n\t\t\t\t},\n\t\t\t\twidth: WIDTH+2*cellSide,\n\t\t\t\theight: HEIGHT,\n\t\t\t},\t\t\t\n\t\t});\n\t\tfor(var ad=0;ad<2;ad++){\n\t\t\txdv.updateGadget(\"field-ad#\"+ad,{\n\t\t\t\t\"2d\":{\n\t\t\t\t\twidth:3*cellSide,\n\t\t\t\t\theight:cellSide,\n\t\t\t\t\trotate:90+ad*180,\n\t\t\t\t\tx:3*cellSide*(ad==0?1:-1),\n\t\t\t\t\tvisible:true,\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tfor(var pos=0;pos<BHEIGHT*BWIDTH;pos++) {\n\t\t\tvar coord=this.getVCoord(pos);\n\t\t\txdv.updateGadget(\"cell#\"+pos, {\n\t\t\t\t\"base\" : {\n\t\t\t\t\tvisible: true,\n\t\t\t\t\tx: coord[0],\n\t\t\t\t\ty: coord[1],\n\t\t\t\t},\n\t\t\t\t\"2d\":{\n\t\t\t\t\twidth: cellSide,\n\t\t\t\t\theight: cellSide,\n\t\t\t\t},\n\n\t\t\t});\t\t\t\t\n\t\t\txdv.updateGadget(\"text#\"+pos, {\n\t\t\t\t\"base\":{\n\t\t\t\t\tvisible: $this.mNotation,\n\t\t\t\t},\n\t\t\t\t\"2d\" : {\n\t\t\t\t\twidth: cellSide/4,\n\t\t\t\t\theight: cellSide/4,\n\t\t\t\t\tx: coord[0]-cellSide*.32,\n\t\t\t\t\ty: coord[1]-cellSide*.37,\n\t\t\t\t},\n\t\t\t\t\"3d\" : {\n\t\t\t\t\tx: coord[0]-cellSide*.37,\n\t\t\t\t\ty: coord[1]+cellSide*.37,\n\t\t\t\t},\n\t\t\t});\t\t\t\t\n\t\t}\n\t\txdv.updateGadget(\"videoa\",{\n\t\t\t\"3d\": {\n\t\t\t\tvisible: true,\n\t\t\t\trotate: 180,\n\t\t\t\tplayerSide: 1,\n\t\t\t},\n\t\t});\n\n\t\txdv.updateGadget(\"videob\",{\n\t\t\t\"3d\": {\n\t\t\t\tvisible: true,\n\t\t\t\trotate: 0,\n\t\t\t\tplayerSide: -1,\n\t\t\t},\n\t\t});\n\t}\n\n\tView.Board.xdDisplay = function(xdv, aGame) {\n\t\tfor(var i=0;i<this.pieces.length;i++) {\n\t\t\tvar piece=this.pieces[i];\n\t\t\tvar coord=aGame.getVCoord(piece.p);\n\t\t\txdv.updateGadget(\"player#\"+i,{\n\t\t\t\tbase: {\n\t\t\t\t\tvisible : true,\n\t\t\t\t\tx : coord[0],\n\t\t\t\t\ty : coord[1],\n\t\t\t\t\trotate: piece.s==aGame.mViewAs?0:180,\n\t\t\t\t},\n\t\t\t\t\"3d\":{\n\t\t\t\t\trotate: aGame.mViewAs==1?piece.a:180+piece.a,\n\t\t\t\t\tmorphing: piece.sc?[0,0,1,0,0,0,0,0,0,0,0]:[1,0,0,0,0,0,0,0,0,0,0,0],\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tvar ballCoord=aGame.getVCoord(this.ball);\n\t\txdv.updateGadget(\"ball\",{\n\t\t\tbase: {\n\t\t\t\tvisible : true,\n\t\t\t\tx : ballCoord[0],\n\t\t\t\ty : ballCoord[1],\n\t\t\t},\n\t\t\t\"3d\": {\n\t\t\t\tz : 500,\t\t\t\t\n\t\t\t},\n\t\t});\n\t\tif (this.scrum) \n\t\t\tSuperShowArrow(aGame,xdv,true,this.ball,this.scrumExit);\n\t\telse\n\t\t\txdv.updateGadget(\"arrowscrum\",{\n\t\t\t\tbase : {\n\t\t\t\t\tvisible: false,\n\t\t\t\t}\n\t\t\t});\n\n\t\t/* if(followBall)\n\t\t\txdv.updateGadget(\"camera\",{\n\t\t\t\t\"3d\": {\n\t\t\t\t\ttargetX : 0,\n\t\t\t\t\ttargetY : ballCoord[1],\n\t\t\t\t\ttargetEasing: TWEEN.Easing.Sinusoidal.EaseInOut,\n\t\t\t\t\ttraveling: true,\n\t\t\t\t},\n\t\t\t},2000); */\n\t}\n\t\n\tfunction SuperShowArrow(aGame,xdv,scrumArrow,pos0,pos1) {\n\t\tvar coord0=aGame.getVCoord(pos0);\n\t\tvar r0=Math.floor(pos0/BWIDTH);\n\t\tvar c0=pos0%BWIDTH;\n\t\tvar coord1=aGame.getVCoord(pos1);\n\t\tvar r1=Math.floor(pos1/BWIDTH);\n\t\tvar c1=pos1%BWIDTH;\n\t\tvar rotations={\n\t\t\t\"-1,-1\": -135,\n\t\t\t\"-1,0\": 180,\n\t\t\t\"-1,1\": 135,\n\t\t\t\"0,-1\": -90,\n\t\t\t\"0,1\": 90,\n\t\t\t\"1,-1\": -45,\n\t\t\t\"1,0\": 0,\n\t\t\t\"1,1\": 45,\n\t\t}\n\t\tvar rotations3D={\n\t\t\t\"-1,-1\": 135,\n\t\t\t\"-1,0\": 180,\n\t\t\t\"-1,1\": -135,\n\t\t\t\"0,-1\": 90,\n\t\t\t\"0,1\":  -90,\n\t\t\t\"1,-1\": 45,\n\t\t\t\"1,0\": 0,\n\t\t\t\"1,1\": -45,\n\t\t}\n\t\tvar arrows={\n\t\t\t\t\"-1,-1\": 0,\n\t\t\t\t\"-1,0\": 1,\n\t\t\t\t\"-1,1\": 2,\n\t\t\t\t\"0,-1\": 3,\n\t\t\t\t\"0,1\":  4,\n\t\t\t\t\"1,-1\": 5,\n\t\t\t\t\"1,0\": 6,\n\t\t\t\t\"1,1\": 7,\n\t\t\t}\n\t\tvar rotOffset= aGame.mViewAs==JocGame.PLAYER_B?180:0;\n\t\tvar arrowId=scrumArrow?\"arrowscrum\":\"arrow#\"+arrows[\"\"+(r1-r0)+\",\"+(c1-c0)];\n\t\txdv.updateGadget(arrowId,{\n\t\t\tbase : {\n\t\t\t\tvisible: true,\n\t\t\t\tx : (coord1[0]+coord0[0])/2,\n\t\t\t\ty : (coord1[1]+coord0[1])/2,\n\t\t\t\trotate: rotations[\"\"+(r1-r0)+\",\"+(c1-c0)]+rotOffset,\n\t\t\t},\n\t\t\t\"3d\" : {\t\t\t\n\t\t\t\tscale : [0.1,0.1,0.1],\n\t\t\t\trotate : rotations3D[\"\"+(r1-r0)+\",\"+(c1-c0)]+rotOffset,\n\t\t\t}\n\t\t});\n\t}\n\t\t\n\tView.Board.xdBuildHTStateMachine = function(xdv, htsm, aGame) {\n\t\tvar $this=this;\n\t\t\n\t\tvar doScrum=false;\n\t\tvar isFirst=this.first;\n\t\tif(this.scrum)\n\t\t\taGame.ScrumEachDirection(this.ball,function(pos) {\n\t\t\t\tvar cell=$this.board[pos];\n\t\t\t\tif(cell>=0 && $this.pieces[cell].s==$this.mWho)\n\t\t\t\t\tdoScrum=true;\n\t\t\t});\n\t\tvar cMove={\n\t\t\tseg1i: -1,\n\t\t\tseg1f: -1,\n\t\t\tseg1t: -1,\n\t\t\tseg1b: -1,\n\t\t\tseg2i: -1,\n\t\t\tseg2f: -1,\n\t\t\tseg2t: -1,\n\t\t\tseg2b: -1,\n\t\t}\n\t\tvar ball=this.ball;\n\t\t\n\t\tfunction Highlight(item,type) {\n\t\t\tvar piece=null,pieceIndex=-1,pos,isBall=false;\n\t\t\tif(typeof item==\"object\") {\n\t\t\t\tpiece=item;\n\t\t\t\tpos=piece.p;\n\t\t\t} else {\n\t\t\t\tvar pos=item;\n\t\t\t\tpieceIndex=$this.board[pos];\n\t\t\t\tif(pieceIndex>=0)\n\t\t\t\t\tpiece=$this.pieces[pieceIndex];\n\t\t\t\telse if(pos==ball)\n\t\t\t\t\tisBall=true;\n\t\t\t}\n\t\t\tvar classes=\"\";\n\t\t\tswitch(type) {\n\t\t\tcase \"normal\": classes=aGame.mShowMoves?\"choice-view\":\"\"; break;\n\t\t\tcase \"cancel\": classes=\"choice-cancel\"; break;\n\t\t\t}\n\t\t\tfunction Click() {\n\t\t\t\tswitch(type) {\n\t\t\t\tcase \"normal\":\n\t\t\t\t\thtsm.smQueueEvent(\"E_CLICK\",{pos:pos,piece:piece,index:pieceIndex,ball:isBall});\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"cancel\":\n\t\t\t\t\thtsm.smQueueEvent(\"E_CANCEL\",{pos:pos,piece:piece,index:pieceIndex,ball:isBall});\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar showTarget=(aGame.mShowMoves||(type==\"cancel\"));\n\t\t\txdv.updateGadget(\"cell#\"+pos,{\n\t\t\t\tbase : {\n\t\t\t\t\tclick : Click,\n\t\t\t\t},\n\t\t\t\t\"2d\" : {\n\t\t\t\t\tclasses : classes,\t\t\t\t\t\n\t\t\t\t},\n\t\t\t\t\"3d\" : {\n\t\t\t\t\t//visible : true,\n\t\t\t\t\t//color: 0xff0000,\n\t\t\t\t\tcastShadow: false, //aGame.mShowMoves,\n\t\t\t\t\treceiveShadow: true,\n\t\t\t\t\tmaterials: { \n\t\t\t\t\t\t\"square\" : {\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"ring\" : {\n\t\t\t\t\t\t\t//shininess : 0,\n\t\t\t\t\t\t\t//reflectivity: 0,\n\t\t\t\t\t\t\tcolor : type==\"cancel\"?0xff4400:0x227700,\n\t\t\t\t\t\t\topacity: (showTarget)?1:0,\n\t\t\t\t\t\t\ttransparent: !showTarget,\n\t\t\t\t\t\t}\n\t\t\t\t\t},\t\t\t\t\t\n\t\t\t\t}\n\t\t\t});\n\t\t\tif(piece) \n\t\t\t\txdv.updateGadget(\"player#\"+pieceIndex,{\n\t\t\t\t\tbase : {\n\t\t\t\t\t\tclick : Click,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\telse if(isBall)\n\t\t\t\txdv.updateGadget(\"ball\",{\n\t\t\t\t\tbase : {\n\t\t\t\t\t\tclick : Click,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t}\n\t\tfunction EachPiece(fnt) {\n\t\t\tfor(var i=0; i<$this.pieces.length; i++) {\n\t\t\t\tvar piece=$this.pieces[i];\n\t\t\t\tif(piece.s==$this.mWho)\n\t\t\t\t\tfnt(i,piece.p);\n\t\t\t}\n\t\t}\n\t\tfunction ShowArrow(pos0,pos1){\n\t\t\tSuperShowArrow(aGame,xdv,false,pos0,pos1);\n\t\t}\n\t\tfunction Clean(args) {\n\t\t\tfor ( var pos = 0; pos < BWIDTH*BHEIGHT; pos++) {\n\t\t\t\txdv.updateGadget(\"cell#\" + pos, {\n\t\t\t\t\t\"base\" : {\n\t\t\t\t\t\tclick : null,\n\t\t\t\t\t},\n\t\t\t\t\t\"2d\" : {\n\t\t\t\t\t\tclasses : \"\",\n\t\t\t\t\t},\n\t\t\t\t\t\"3d\":{\n\t\t\t\t\t\tmaterials: {\t\t\t\t\t\t\n\t\t\t\t\t\t\t\"ring\" : {\n\t\t\t\t\t\t\t\topacity: 0,\n\t\t\t\t\t\t\t\ttransparent: true,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tfor( var i=0; i<$this.pieces.length; i++) {\n\t\t\t\tvar piece=$this.pieces[i];\n\t\t\t\txdv.updateGadget(\"player#\"+i, {\n\t\t\t\t\t\"base\" : {\n\t\t\t\t\t\tclick : null,\n\t\t\t\t\t},\n\t\t\t\t});\t\t\t\t\n\t\t\t}\n\t\t\txdv.updateGadget(\"ball\", {\n\t\t\t\t\"base\" : {\n\t\t\t\t\tclick : null,\n\t\t\t\t},\n\t\t\t});\n\t\t\tfor(var i=0;i<8;i++)\n\t\t\t\txdv.updateGadget(\"arrow#\"+i, {\n\t\t\t\t\t\"base\" : {\n\t\t\t\t\t\tvisible : false,\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t}\n\t\tfunction Select1(args) {\n\t\t\tif(doScrum) {\n\t\t\t\taGame.ScrumEachDirection($this.ball,function(pos) {\n\t\t\t\t\tvar cell=$this.board[pos];\n\t\t\t\t\tif(cell>=0 && $this.pieces[cell].s==$this.mWho)\n\t\t\t\t\t\tHighlight(pos,\"normal\");\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tEachPiece(function(index,pos) {\n\t\t\t\t\tHighlight(pos,\"normal\");\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tfunction Click1(args) {\n\t\t\tcMove.seg1f=args.pos;\n\t\t\tcMove.seg1i=args.index;\n\t\t}\n\t\tfunction Select1Dest(args) {\n\t\t\tHighlight(cMove.seg1f,\"cancel\");\n\t\t\tif(doScrum) {\n\t\t\t\tHighlight($this.ball,\"normal\")\n\t\t\t\tShowArrow(cMove.seg1f,$this.ball);\n\t\t\t} else\n\t\t\t\taGame.ScrumEachDirection(cMove.seg1f,function(npos) {\n\t\t\t\t\tif($this.board[npos]<0) {\n\t\t\t\t\t\tHighlight(npos,\"normal\");\n\t\t\t\t\t\tShowArrow(cMove.seg1f,npos);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t}\n\t\tfunction Cancel1(args) {\n\t\t\tcMove.seg1i=-1;\n\t\t\tcMove.seg1f=-1;\n\t\t}\n\t\tfunction CheckClick(args) {\n\t\t\tif(args.ball)\n\t\t\t\thtsm.smQueueEvent(\"E_CLICK_BALL\",args);\n\t\t\telse\n\t\t\t\thtsm.smQueueEvent(\"E_CLICK_CELL\",args);\n\t\t}\n\t\tfunction Select1Ball(args) {\n\t\t\taGame.ScrumEachDirection(ball,function(npos) {\n\t\t\t\tif($this.board[npos]<0) {\n\t\t\t\t\tvar empty=0;\n\t\t\t\t\taGame.ScrumEachDirection(npos,function(npos2) {\n\t\t\t\t\t\tif(($this.board[npos2]==-1 || npos2==cMove.seg1f) && npos2!=ball && npos2!=cMove.seg1t)\n\t\t\t\t\t\t\tempty++;\n\t\t\t\t\t});\n\t\t\t\t\tif(empty>0) {\n\t\t\t\t\t\tHighlight(npos,\"normal\");\n\t\t\t\t\t\tShowArrow(ball,npos);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tHighlight(ball,\"cancel\");\n\t\t}\n\t\tfunction Click1Dest(args) {\n\t\t\tcMove.seg1t=args.pos;\n\t\t}\n\t\tfunction Animate1(args) {\n\t\t\tAnimateMoveSegment(xdv,aGame,$this,cMove.seg1i,cMove.seg1t,cMove.seg1b,function() {\n\t\t\t\thtsm.smQueueEvent(\"E_ANIMATE_END\",{});\n\t\t\t\t\n\t\t\t});\n\t\t}\n\t\tfunction Click1Ball(args) {\n\t\t\tcMove.seg1b=args.pos;\n\t\t\tball=args.pos;\n\t\t}\n\t\tfunction Click2(args) {\n\t\t\tcMove.seg2i=args.index;\n\t\t\tcMove.seg2f=args.pos;\n\t\t}\n\t\tfunction Select2(args) {\n\t\t\tEachPiece(function(index,pos) {\n\t\t\t\tif(index!=cMove.seg1i)\n\t\t\t\t\tHighlight(pos,\"normal\");\n\t\t\t});\n\t\t\tif(cMove.seg1b>=0)\n\t\t\t\tHighlight(cMove.seg1b,\"cancel\");\n\t\t\telse\n\t\t\t\tHighlight(cMove.seg1t,\"cancel\");\n\t\t}\n\t\tfunction Cancel1Dest(args) {\n\t\t\tcMove.seg1t=-1;\n\t\t}\n\t\tfunction Cancel1Full(args) {\n\t\t\tvar coord=aGame.getVCoord(cMove.seg1f);\n\t\t\txdv.updateGadget(\"player#\"+cMove.seg1i,{\n\t\t\t\tbase : {\n\t\t\t\t\tx : coord[0],\n\t\t\t\t\ty : coord[1],\n\t\t\t\t},\n\t\t\t});\n\t\t\tvar coord=aGame.getVCoord($this.ball);\n\t\t\txdv.updateGadget(\"ball\",{\n\t\t\t\tbase : {\n\t\t\t\t\tx : coord[0],\n\t\t\t\t\ty : coord[1],\n\t\t\t\t},\n\t\t\t});\n\t\t\tball=$this.ball;\n\t\t\tcMove.seg1i=-1;\n\t\t\tcMove.seg1f=-1;\n\t\t\tcMove.seg1t=-1;\n\t\t\tcMove.seg1b=-1;\n\t\t}\n\t\tfunction Select2Dest(args) {\n\t\t\tHighlight(cMove.seg2f,\"cancel\");\n\t\t\taGame.ScrumEachDirection(cMove.seg2f,function(npos) {\n\t\t\t\tif(npos==cMove.seg1f || ($this.board[npos]<0 && npos!=cMove.seg1t) ) {\n\t\t\t\t\tHighlight(npos,\"normal\");\n\t\t\t\t\tShowArrow(cMove.seg2f,npos);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\tfunction Cancel2(args) {\n\t\t\tcMove.seg2f=-1;\n\t\t\tcMove.seg2i=-1;\n\t\t}\n\t\tfunction Cancel2Dest(args) {\n\t\t}\n\t\tfunction Click2Dest(args) {\n\t\t\tcMove.seg2t=args.pos;\n\t\t}\n\t\tfunction Animate2(args) {\n\t\t\tAnimateMoveSegment(xdv,aGame,$this,cMove.seg2i,cMove.seg2t,cMove.seg2b,function() {\n\t\t\t\thtsm.smQueueEvent(\"E_ANIMATE_END\",{});\n\t\t\t});\n\t\t}\n\t\tfunction Select2Ball(args) {\n\t\t\taGame.ScrumEachDirection(ball,function(npos) {\n\t\t\t\tif(npos==cMove.seg1f || ($this.board[npos]<0 && npos!=cMove.seg1t && npos!=cMove.seg2f)) {\n\t\t\t\t\tvar empty=0;\n\t\t\t\t\taGame.ScrumEachDirection(npos,function(npos2) {\n\t\t\t\t\t\tif(($this.board[npos2]==-1 || npos2==cMove.seg1f || npos2==cMove.seg2f) && npos2!=ball && npos2!=cMove.seg1t && npos2!=cMove.seg2t)\n\t\t\t\t\t\t\tempty++;\n\t\t\t\t\t});\n\t\t\t\t\tif(empty>0) {\n\t\t\t\t\t\tHighlight(npos,\"normal\");\n\t\t\t\t\t\tShowArrow(ball,npos);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tHighlight(ball,\"cancel\");\n\t\t}\n\t\tfunction MakeMove(args) {\n\t\t\tvar move={seg:[{f:cMove.seg1f,t:cMove.seg1t}]};\n\t\t\tif(cMove.seg1b>=0)\n\t\t\t\tmove.seg[0].b=cMove.seg1b;\n\t\t\tif(cMove.seg2f>=0) {\n\t\t\t\tmove.seg.push({f:cMove.seg2f,t:cMove.seg2t});\n\t\t\t\tif(cMove.seg2b>=0)\n\t\t\t\t\tmove.seg[1].b=cMove.seg2b;\n\t\t\t}\n\t\t\tvar ball=$this.ball;\n\t\t\tif(cMove.seg1b>=0)\n\t\t\t\tball=cMove.seg1b;\n\t\t\tif(cMove.seg2b>=0)\n\t\t\t\tball=cMove.seg2b;\n\t\t\tvar empty=0;\n\t\t\taGame.ScrumEachDirection(ball,function(pos) {\n\t\t\t\tif((pos==cMove.seg1f || pos==cMove.seg2f || $this.board[pos]<0) && pos!=cMove.seg1t && pos!=cMove.seg2t)\n\t\t\t\t\tempty++;\n\t\t\t});\n\t\t\tif(empty==1)\n\t\t\t\taGame.PlaySound(\"whistle\");\n\t\t\taGame.HumanMove(move);\n\t\t}\n\t\tfunction Click2Ball(args) {\n\t\t\tcMove.seg2b=args.pos;\n\t\t}\n\t\tfunction CheckEnd(args) {\n\t\t\tif(isFirst || doScrum)\n\t\t\t\thtsm.smQueueEvent(\"E_MOVE_END\",{});\n\t\t\telse {\n\t\t\t\tvar ballRow=Math.floor(ball/BWIDTH);\n\t\t\t\tif((ballRow==0 && $this.mWho==JocGame.PLAYER_B) || (ballRow==BHEIGHT-1 && $this.mWho==JocGame.PLAYER_A))\n\t\t\t\t\thtsm.smQueueEvent(\"E_MOVE_END\",{});\n\t\t\t\telse\n\t\t\t\t\thtsm.smQueueEvent(\"E_CONTINUE\",{});\n\t\t\t}\n\t\t}\n\t\t\n\t\thtsm.smTransition(\"S_INIT\", \"E_INIT\", \"S_SELECT1\", [ ]);\n\n\t\thtsm.smEntering(\"S_SELECT1\",[ Select1 ]);\n\t\thtsm.smTransition(\"S_SELECT1\", \"E_CLICK\", \"S_SELECT1D\", [ Click1 ]);\n\t\thtsm.smLeaving(\"S_SELECT1\",[ Clean ]);\n\t\t\n\t\thtsm.smEntering(\"S_SELECT1D\",[ Select1Dest ]);\n\t\thtsm.smTransition(\"S_SELECT1D\", \"E_CLICK\", null, [ CheckClick ]);\n\t\thtsm.smTransition(\"S_SELECT1D\", \"E_CANCEL\", \"S_SELECT1\", [ Cancel1 ]);\n\t\thtsm.smTransition(\"S_SELECT1D\", \"E_CLICK_CELL\", \"S_ANIMATE1\", [ Click1Dest ]);\n\t\thtsm.smTransition(\"S_SELECT1D\", \"E_CLICK_BALL\", \"S_SELECT1B\", [ Click1Dest ]);\n\t\thtsm.smLeaving(\"S_SELECT1D\",[ Clean ]);\n\t\t\n\t\thtsm.smEntering(\"S_SELECT1B\",[ Select1Ball ]);\n\t\thtsm.smTransition(\"S_SELECT1B\", \"E_CLICK\", \"S_ANIMATE1\", [ Click1Ball ]);\n\t\thtsm.smTransition(\"S_SELECT1B\", \"E_CANCEL\", \"S_SELECT1D\", [ Cancel1Dest ]);\n\t\thtsm.smLeaving(\"S_SELECT1B\",[ Clean ]);\n\n\t\thtsm.smEntering(\"S_ANIMATE1\",[ Animate1 ]);\n\t\thtsm.smTransition(\"S_ANIMATE1\",\"E_ANIMATE_END\",null,[ CheckEnd ]);\n\t\thtsm.smTransition(\"S_ANIMATE1\",\"E_MOVE_END\",null,[ MakeMove ]);\n\t\thtsm.smTransition(\"S_ANIMATE1\",\"E_CONTINUE\",\"S_SELECT2\",[]);\n\t\t\n\t\thtsm.smEntering(\"S_SELECT2\",[ Select2 ]);\n\t\thtsm.smTransition(\"S_SELECT2\",\"E_CLICK\",\"S_SELECT2D\",[ Click2 ])\n\t\thtsm.smTransition(\"S_SELECT2\",\"E_CANCEL\",\"S_SELECT1\",[ Cancel1Full ])\t\t\n\t\thtsm.smLeaving(\"S_SELECT2\",[ Clean ]);\n\n\t\thtsm.smEntering(\"S_SELECT2D\",[ Select2Dest ]);\n\t\thtsm.smTransition(\"S_SELECT2D\", \"E_CLICK\", null, [ CheckClick ]);\n\t\thtsm.smTransition(\"S_SELECT2D\", \"E_CANCEL\", \"S_SELECT2\", [ Cancel2 ]);\n\t\thtsm.smTransition(\"S_SELECT2D\", \"E_CLICK_CELL\", \"S_ANIMATE2\", [ Click2Dest ]);\n\t\thtsm.smTransition(\"S_SELECT2D\", \"E_CLICK_BALL\", \"S_SELECT2B\", [ Click2Dest ]);\n\t\thtsm.smLeaving(\"S_SELECT2D\",[ Clean ]);\n\n\t\thtsm.smEntering(\"S_SELECT2B\",[ Select2Ball ]);\n\t\thtsm.smTransition(\"S_SELECT2B\", \"E_CLICK\", \"S_ANIMATE2\", [ Click2Ball ]);\n\t\thtsm.smLeaving(\"S_SELECT2B\",[ Clean ]);\n\n\t\thtsm.smEntering(\"S_ANIMATE2\",[ Animate2 ]);\n\t\thtsm.smTransition(\"S_ANIMATE2\",\"E_ANIMATE_END\",\"S_DONE\",[ MakeMove ]);\n\t\t\n\t\t\n\t\thtsm.smTransition([\"S_SELECT1\",\"S_SELECT1D\",\"S_SELECT1B\",\"S_ANIMATE1\",\"S_SELECT2\",\"S_SELECT2D\",\"S_SELECT2B\",\"S_ANIMATE2\",\"S_DONE\"],\"E_END\",\"S_DONE\",[]);\n\t\thtsm.smEntering(\"S_DONE\",[Clean]);\n\t}\n\n\tfunction AnimateScrum(xdv,aGame,aBoard,oldBoard,callback) {\n\t\tvar animCount=1;\n\t\tfunction AnimEnd() {\n\t\t\tif(--animCount==0)\n\t\t\t\tcallback();\n\t\t}\n\t\tfor(var i=0;i<aBoard.pieces.length;i++) {\n\t\t\tvar piece=aBoard.pieces[i];\n\t\t\tvar piece0=oldBoard.pieces[i];\n\t\t\tif(piece.sc!=piece0.sc) {\n\t\t\t\tanimCount++;\n\t\t\t\txdv.updateGadget(\"player#\"+i,{\n\t\t\t\t\tbase: {\n\t\t\t\t\t\trotate: piece.s==aGame.mViewAs?0:180,\n\t\t\t\t\t},\n\t\t\t\t\t\"3d\":{\n\t\t\t\t\t\tmorphing: piece.sc?[0,0,1,0,0,0,0,0,0,0,0]:[1,0,0,0,0,0,0,0,0,0,0,0],\n\t\t\t\t\t\trotate: aGame.mViewAs==1?piece.a:180+piece.a,\n\t\t\t\t\t}\n\t\t\t\t},500,AnimEnd);\n\t\t\t}\n\t\t}\n\t\tAnimEnd();\n\t}\n\n\t\n\tView.Board.xdPlayedMove = function(xdv, aGame, aMove) {\n\t\tvar $this=this;\n\t\tfunction MoveDone() {\n\t\t\tAnimateScrum(xdv,aGame,$this,aGame.mOldBoard,function() {\n\t\t\t\taGame.MoveShown();\t\t\t\t\n\t\t\t});\n\t\t}\n\t\tAnimateMoveSegment(xdv,aGame,aGame.mOldBoard,this.board[aMove.seg[0].t],aMove.seg[0].t,aMove.seg[0].b,function() {\n\t\t\tif(aMove.seg.length>1)\n\t\t\t\tAnimateMoveSegment(xdv,aGame,aGame.mOldBoard,$this.board[aMove.seg[1].t],aMove.seg[1].t,aMove.seg[1].b,function() {\n\t\t\t\t\tMoveDone();\n\t\t\t\t\tif($this.scrum)\n\t\t\t\t\t\taGame.PlaySound(\"whistle\");\n\t\t\t\t});\n\t\t\telse {\n\t\t\t\tMoveDone();\n\t\t\t\tif($this.scrum)\n\t\t\t\t\taGame.PlaySound(\"whistle\");\n\t\t\t}\n\t\t});\n\t\treturn false;\n\t}\n\n\tView.Game.scrumDrawDashLine = function(ctx, x0, y0, x1, y1, nbdashes,\n\t\t\tdashpercent) {\n\t\tvar a = 0;\n\t\tif (x1 != x0) {\n\t\t\ta = (y1 - y0) / (x1 - x0);\n\t\t\tvar b = y0 - a * x0;\n\t\t\tfor ( var i = 0; i < nbdashes; i++) {\n\t\t\t\tvar xs = x0 + (x1 - x0) / nbdashes\n\t\t\t\t\t\t* (i + (100 - dashpercent) / 200);\n\t\t\t\tvar xe = x0 + (x1 - x0) / nbdashes\n\t\t\t\t\t\t* (i + dashpercent / 100 + (100 - dashpercent) / 200);\n\t\t\t\tvar ys = a * xs + b;\n\t\t\t\tvar ye = a * xe + b;\n\t\t\t\tctx.moveTo(xs, ys);\n\t\t\t\tctx.lineTo(xe, ye);\n\t\t\t}\n\t\t} else {\n\t\t\tfor ( var i = 0; i < nbdashes; i++) {\n\t\t\t\tvar ys = y0 + (y1 - y0) / nbdashes\n\t\t\t\t\t\t* (i + (100 - dashpercent) / 200);\n\t\t\t\tvar ye = y0 + (y1 - y0) / nbdashes\n\t\t\t\t\t\t* (i + dashpercent / 100 + (100 - dashpercent) / 200);\n\t\t\t\tctx.moveTo(x0, ys);\n\t\t\t\tctx.lineTo(x0, ye);\n\t\t\t}\n\t\t}\n\t}\n\n\tView.Game.scrumDraw15metersMarks = function(ctx, y, REALWIDTH, fieldW, h,\n\t\t\tfieldXstart) {\n\t\tvar x = fieldXstart + fieldW * 15 / REALWIDTH;\n\t\tctx.moveTo(x, y - h / 2);\n\t\tctx.lineTo(x, y + h / 2);\n\t\tx = fieldXstart + fieldW * (REALWIDTH - 15) / REALWIDTH;\n\t\tctx.moveTo(x, y - h / 2);\n\t\tctx.lineTo(x, y + h / 2);\n\t}\n\tView.Game.scrumDraw22texts = function(ctx, y, cellSide, fieldW, fieldXstart) {\n\t\t// 22 text\n\t\tctx.save();\n\t\tctx.fillStyle = \"rgba(255,255,255,0.3)\";\n\t\tctx.font = (cellSide / 3) + \"pt Arial\";\n\t\tctx.translate(fieldXstart, y);\n\t\tctx.rotate(-Math.PI / 2);\n\t\tctx.textAlign = \"center\";\n\t\tctx.fillText(\"22\", 0, cellSide / 3 + 2);\n\t\tctx.fillText(\"22\", 0, fieldW - 4);\n\t\tctx.restore();\n\t}\n\n\tView.Game.scrumDrawGoals = function(ctx,pixSize,boardW,boardH,xtraTouchCells,cellSide) {\n\n\t\tvar fieldH = boardH - 2 * cellSide;\n\t\tvar fieldYstart = cellSide;\n\t\tvar fieldW = boardW;\n\t\tvar fieldXstart = 0;\n\n\t\t// goals\n\t\tctx.beginPath();\n\t\tctx.strokeStyle = \"rgba(255,255,255,1.0)\";\n\t\tctx.lineWidth = 4*pixSize;\n\t\tvar goalwidth = fieldW * 10.8 / 100;\n\t\tvar goalH = cellSide / 3;\n\t\ty = cellSide;\n\t\tx = fieldXstart + (fieldW - goalwidth) / 2;\n\t\tctx.moveTo(x, y);\n\t\tctx.lineTo(x - goalH, y - goalH);\n\t\tvar x2 = fieldXstart + (fieldW + goalwidth) / 2;\n\t\tctx.moveTo(x2, y);\n\t\tctx.lineTo(x2 + goalH, y - goalH);\n\t\tctx.moveTo(x2 + goalH / 3, y - goalH / 3);\n\t\tctx.lineTo(x - goalH / 3, y - goalH / 3);\n\n\t\ty = fieldH + cellSide;\n\t\tx = fieldXstart + (fieldW - goalwidth) / 2;\n\t\tctx.moveTo(x, y);\n\t\tctx.lineTo(x - goalH, y + goalH);\n\t\tx2 = fieldXstart + (fieldW + goalwidth) / 2;\n\t\tctx.moveTo(x2, y);\n\t\tctx.lineTo(x2 + goalH, y + goalH);\n\t\tctx.moveTo(x2 + goalH / 3, y + goalH / 3);\n\t\tctx.lineTo(x - goalH / 3, y + goalH / 3);\n\t\tctx.closePath();\n\t\tctx.stroke();\n\n\t\tctx.stroke();\n\t}\n\n\tView.Game.scrumDrawBoard2 = function(ctx,pixSize,boardW,boardH,xtraTouchCells) {\n\t\tctx.translate(-boardW/2,-boardH/2);\n\t\tctx.fillStyle = \"rgba(0,185,0,0.3)\";\n\t\tctx.beginPath();\n\t\tctx.rect(0, 0, boardW, boardH);\n\t\tctx.closePath();\n\t\tctx.fill();\n\t\tthis.scrumDrawGoals(ctx,pixSize,boardW,boardH,xtraTouchCells,cellSide);\n\t}\n\n\tView.Game.scrumDrawBoard = function(ctx,pixSize,boardW,boardH,xtraTouchCells) {\n\t\t\n\t\tctx.translate(-boardW/2,-boardH/2);\n\t\t\t\t\n\t\t/*var boardGradient = ctx.createRadialGradient(-boardW / 2,\n\t\t\t\t-boardW / 2, 0, boardW / 6 * 4,\n\t\t\t\tboardW / 6 * 2, boardW * 2);\n\t\tboardGradient.addColorStop(0, \"#BAF445\");\n\t\tboardGradient.addColorStop(1, \"#008000\");\n\n\t\tctx.fillStyle = boardGradient;*/\n\t\t\n\t\tctx.fillStyle = \"rgb(0,185,0)\";\n\t\tctx.beginPath();\n\t\tctx.rect(0, 0, boardW, boardH);\n\t\tctx.closePath();\n\t\tctx.fill();\n\n\t\tvar fieldH = boardH - 2 * cellSide;\n\t\tvar fieldYstart = cellSide;\n\t\tvar fieldW = boardW - (xtraTouchCells * cellSide);\n\t\tvar fieldXstart = (xtraTouchCells * cellSide) / 2;\n\n\t\tvar REALLENGTH = 100;\n\t\tvar REALWIDTH = 60;\n\t\t// goal lines\n\t\tctx.beginPath();\n\t\tctx.strokeStyle = \"rgba(255,255,255,0.8)\";\n\t\tctx.lineWidth = 2*pixSize;\n\t\tctx.moveTo(fieldXstart, fieldYstart);\n\t\tctx.lineTo(fieldXstart + fieldW, fieldYstart);\n\t\tctx.moveTo(fieldXstart, fieldYstart + fieldH);\n\t\tctx.lineTo(fieldXstart + fieldW, fieldYstart + fieldH);\n\t\tctx.closePath();\n\t\tctx.stroke();\n\n\t\t// touch lines\n\t\tctx.moveTo(fieldXstart, 0);\n\t\tctx.lineTo(fieldXstart, boardH);\n\t\tctx.moveTo(fieldXstart + fieldW, 0);\n\t\tctx.lineTo(fieldXstart + fieldW, boardH);\n\t\tctx.stroke();\n\n\t\t// top 22m line\n\t\tctx.strokeStyle = \"rgba(255,255,255,0.4)\";\n\t\tctx.beginPath();\n\t\tvar y = fieldYstart + (fieldH * 22) / REALLENGTH;\n\t\tvar h = cellSide;\n\t\tctx.moveTo(fieldXstart, y);\n\t\tctx.lineTo(fieldXstart + fieldW, y);\n\t\tthis.scrumDraw15metersMarks(ctx, y, REALWIDTH, fieldW, h, fieldXstart);\n\n\t\tthis.scrumDraw22texts(ctx, y, cellSide, fieldW, fieldXstart);\n\n\t\t// 50m line\n\t\tvar y = fieldYstart + fieldH / 2;\n\t\tctx.moveTo(fieldXstart, y);\n\t\tctx.lineTo(fieldXstart + fieldW, y);\n\t\tthis.scrumDraw15metersMarks(ctx, y, REALWIDTH, fieldW, h, fieldXstart);\n\t\t// bottom 22m line\n\t\ty = fieldYstart + fieldH - (fieldH * 22) / REALLENGTH;\n\t\tctx.moveTo(fieldXstart, y);\n\t\tctx.lineTo(fieldXstart + fieldW, y);\n\t\tthis.scrumDraw15metersMarks(ctx, y, REALWIDTH, fieldW, h, fieldXstart);\n\t\tctx.closePath();\n\t\tctx.stroke();\n\n\t\t// 22 text\n\t\tthis.scrumDraw22texts(ctx, y, cellSide, fieldW, fieldXstart);\n\n\t\t// 5m line\n\t\tctx.beginPath();\n\t\tctx.strokeStyle = \"rgba(255,255,255,0.3)\";\n\t\ty = fieldYstart + (fieldH * 5) / REALLENGTH;\n\t\tthis.scrumDrawDashLine(ctx, fieldXstart + (fieldW * 5) / REALWIDTH, y,\n\t\t\t\tfieldXstart + (fieldW * (REALWIDTH - 5)) / REALWIDTH, y, 6, 60);\n\t\t// 5m line\n\t\ty = fieldYstart + fieldH - (fieldH * 5) / REALLENGTH;\n\t\tthis.scrumDrawDashLine(ctx, fieldXstart + (fieldW * 5) / REALWIDTH, y,\n\t\t\t\tfieldXstart + (fieldW * (REALWIDTH - 5)) / REALWIDTH, y, 6, 60);\n\t\tctx.closePath();\n\t\tctx.stroke();\n\n\t\tctx.beginPath();\n\t\tctx.strokeStyle = \"rgba(255,255,255,0.3)\";\n\t\t// 10m line\n\t\ty = fieldYstart + fieldH / 2 - (fieldH * 10) / REALLENGTH;\n\t\tthis.scrumDrawDashLine(ctx, fieldXstart + (fieldW * 5) / REALWIDTH, y,\n\t\t\t\tfieldXstart + (fieldW * (REALWIDTH - 5)) / REALWIDTH, y, 6, 60);\n\t\t// 10m line\n\t\ty = fieldYstart + fieldH / 2 + (fieldH * 10) / REALLENGTH;\n\t\tthis.scrumDrawDashLine(ctx, fieldXstart + (fieldW * 5) / REALWIDTH, y,\n\t\t\t\tfieldXstart + (fieldW * (REALWIDTH - 5)) / REALWIDTH, y, 6, 60);\n\t\tctx.closePath();\n\t\tctx.stroke();\n\n\t\tctx.beginPath();\n\t\tctx.strokeStyle = \"rgba(255,255,255,0.3)\";\n\t\t// vertical lines\n\t\tvar x = fieldXstart + (fieldW * 5) / REALWIDTH;\n\t\tthis.scrumDrawDashLine(ctx, x, fieldYstart, x, boardH\n\t\t\t\t- fieldYstart, 40, 30);\n\t\tvar x = fieldXstart + (fieldW * (REALWIDTH - 5)) / REALWIDTH;\n\t\tthis.scrumDrawDashLine(ctx, x, fieldYstart, x, boardH\n\t\t\t\t- fieldYstart, 40, 30);\n\t\tctx.closePath();\n\t\tctx.stroke();\n\n\t\tvar goalwidth = fieldW * 15 / 100;\n\t\tvar goalH = cellSide / 3;\n\t\tctx.beginPath();\n\t\tctx.strokeStyle = \"rgba(255,255,255,1.0)\";\n\t\tctx.lineWidth = 2*pixSize;\n\t\tctx.moveTo(fieldXstart, fieldYstart);\n\t\tctx.lineTo(fieldXstart - goalH / 3, fieldYstart - goalH / 6);\n\t\tctx.moveTo(fieldXstart + fieldW, fieldYstart);\n\t\tctx.lineTo(fieldXstart + fieldW + goalH / 3, fieldYstart - goalH / 6);\n\t\tctx.moveTo(fieldXstart, fieldYstart + fieldH);\n\t\tctx.lineTo(fieldXstart - goalH / 3, fieldYstart + fieldH + goalH / 6);\n\t\tctx.moveTo(fieldXstart + fieldW, fieldYstart + fieldH);\n\t\tctx.lineTo(fieldXstart + fieldW + goalH / 3, fieldYstart + fieldH\n\t\t\t\t+ goalH / 6);\n\t\tctx.closePath();\n\t\tctx.stroke();\n\t\t\n\t\tthis.scrumDrawGoals(ctx,pixSize,boardW,boardH,xtraTouchCells,cellSide);\n\t}\n\n\tfunction AnimateMoveSegment(xdv,aGame,aBoard,pieceIndex,to,ball,callback) {\n\t\tvar piece=aBoard.pieces[pieceIndex];\n\t\tvar animCount=1;\n\t\tfunction AnimEnd() {\n\t\t\tif(--animCount==0)\n\t\t\t\tcallback();\n\t\t}\n\t\tvar coord=aGame.getVCoord(to);\n\t\t\n\t\tvar from=piece.p;\n\t\tvar r0=Math.floor(from/BWIDTH);\n\t\tvar c0=from%BWIDTH;\n\t\tvar r1=Math.floor(to/BWIDTH);\n\t\tvar c1=to%BWIDTH;\n\t\tvar rotation3D={\n\t\t\t\"-1,-1\": 135,\n\t\t\t\"-1,0\": 180,\n\t\t\t\"-1,1\": -135,\n\t\t\t\"0,-1\": 90,\n\t\t\t\"0,1\":  -90,\n\t\t\t\"1,-1\": 45,\n\t\t\t\"1,0\": 0,\n\t\t\t\"1,1\": -45,\n\t\t}[\"\"+(r1-r0)+\",\"+(c1-c0)];\n\t\tvar rotation={\n\t\t\t\"-1,-1\": -135,\n\t\t\t\"-1,0\": 180,\n\t\t\t\"-1,1\": 135,\n\t\t\t\"0,-1\": -90,\n\t\t\t\"0,1\": 90,\n\t\t\t\"1,-1\": -45,\n\t\t\t\"1,0\": 0,\n\t\t\t\"1,1\": 45,\n\t\t}[\"\"+(r1-r0)+\",\"+(c1-c0)];\n\t\t\n\t\txdv.updateGadget(\"player#\"+pieceIndex,{\n\t\t\t\"2d\" : {\n\t\t\t\trotate: (aGame.mViewAs==JocGame.PLAYER_A?0:180)+rotation,\n\t\t\t},\n\t\t});\n\t\t\n\t\tvar sequence=[\n\t\t    \t      [0,0,0,1,0,0,0,0,0,0,0,0],\n\t\t    \t      [0,0,0,0,1,0,0,0,0,0,0,0],\n\t\t    \t      [0,0,0,0,0,1,0,0,0,0,0,0],\n\t\t    \t      [0,0,0,0,0,0,1,0,0,0,0,0],\n\t\t    \t      [0,0,0,0,0,0,0,1,0,0,0,0],\n\t\t    \t      [0,0,0,0,0,0,0,0,1,0,0,0],\n\t\t    \t      [0,0,0,0,0,0,0,0,0,1,0,0],\n\t\t    \t      [0,0,0,0,0,0,0,0,0,0,1,0],\n\t\t    \t      [1,0,0,0,0,0,0,0,0,0,0,0],\n\t\t];\n\t\tvar seqIndex=0;\n\n\t\tvar coord0=aGame.getVCoord(piece.p);\n\t\t\n\t\tfunction Anim() {\n\t\t\tif(seqIndex==sequence.length) {\n\t\t\t\txdv.updateGadget(\"player#\"+pieceIndex,{\n\t\t\t\t\tbase : {\n\t\t\t\t\t\tx : coord[0],\n\t\t\t\t\t\ty : coord[1],\n\t\t\t\t\t},\n\t\t\t\t\t\"3d\" : {\n\t\t\t\t\t\trotate: (aGame.mViewAs==JocGame.PLAYER_A?0:180)+piece.a,\n\t\t\t\t\t},\n\t\t\t\t},500);\n\t\t\t\tAnimEnd();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar morphStep=sequence[seqIndex++];\n\t\t\txdv.updateGadget(\"player#\"+pieceIndex,{\n\t\t\t\tbase : {\n\t\t\t\t\tx : coord0[0]+(coord[0]-coord0[0])*(seqIndex/sequence.length),\n\t\t\t\t\ty : coord0[1]+(coord[1]-coord0[1])*(seqIndex/sequence.length),\n\t\t\t\t},\n\t\t\t\t\"3d\" : {\n\t\t\t\t\tmorphing: morphStep,\n\t\t\t\t\trotate: (aGame.mViewAs==JocGame.PLAYER_A?180:0)+rotation3D,\n\t\t\t\t},\n\t\t\t},50,Anim);\n\t\t}\n\t\tAnim();\n\n\t\tif(ball>=0) {\n\t\t\tanimCount++;\n\t\t\tvar coordb=aGame.getVCoord(ball);\n\t\t\txdv.updateGadget(\"ball\",{\n\t\t\t\tbase : {\n\t\t\t\t\tx : coordb[0],\n\t\t\t\t\ty : coordb[1],\n\t\t\t\t}\n\t\t\t},500,function() {\n\t\t\t\tAnimEnd();\n\t\t\t});\n\t\t\t/* if(followBall)\n\t\t\t\txdv.updateGadget(\"camera\",{\n\t\t\t\t\t\"3d\": {\n\t\t\t\t\t\ttargetX : 0,\n\t\t\t\t\t\ttargetY : coordb[1],\n\t\t\t\t\t\ttargetEasing: TWEEN.Easing.Sinusoidal.EaseInOut,\n\t\t\t\t\t\ttraveling: true,\n\t\t\t\t\t},\n\t\t\t\t},2000); */\n\t\t}\n\t}\n\n\tView.Board.xdShowEnd=function(xdv,aGame) {\n\n\t\tfollowBall=true;\n\t\t\n\t\tif(this.mWinner==JocGame.DRAW)\n\t\t\treturn true;\n\n\t\tvar animCount=1;\n\t\tfunction AnimEnd() {\n\t\t\tif(--animCount==0)\n\t\t\t\taGame.EndShown();\n\t\t}\n\t\tfor(var i=0;i<this.pieces.length;i++) {\n\t\t\tvar piece=this.pieces[i];\n\t\t\tif(piece.s==this.mWinner) {\n\t\t\t\tanimCount++;\n\t\t\t\t(function(i) {\n\t\t\t\t\txdv.updateGadget(\"player#\"+i,{\n\t\t\t\t\t\t\"3d\" : {\n\t\t\t\t\t\t\tmorphing: [0,0,0,0,0,0,0,0,0,0,0,1],\n\t\t\t\t\t\t},\n\t\t\t\t\t},1000,function() {\n\t\t\t\t\t\txdv.updateGadget(\"player#\"+i,{\n\t\t\t\t\t\t\t\"3d\" : {\n\t\t\t\t\t\t\t\tmorphing: [1,0,0,0,0,0,0,0,0,0,0,0],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},1000,AnimEnd);\n\t\t\t\t\t});\n\t\t\t\t})(i);\n\t\t\t}\n\t\t}\n\t\t\n\t\txdv.updateGadget(\"ball\",{\n\t\t\t\"3d\": {\n\t\t\t\tz : 0,\t\t\t\t\n\t\t\t},\n\t\t},1000,function() {\n\t\t\txdv.updateGadget(\"ball\",{\n\t\t\t\t\"3d\": {\n\t\t\t\t\tz : 500,\t\t\t\t\n\t\t\t\t},\n\t\t\t},1000,function() {\n\t\t\t\tAnimEnd();\n\t\t\t});\n\t\t});\n\n\t\treturn false;\n\t}\n\n})();\n"],"file":"scrum-view.js"}
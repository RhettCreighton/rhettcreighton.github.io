{"version":3,"names":[],"mappings":"","sources":["wild-tamerlane-view.js"],"sourcesContent":["/*\n *\n * \n * \n * authors: jerome choain\n *\n */\n\n(function() {\n\n    function createTexturedPatternCanvas(W,H,texture,clipW,clipH,mask,borderFact){ \n    \t// borderFact is the percentage (/100) of the mask transition overlay border : ex 30% => .3\n        var cv = document.createElement('canvas');\n        cv.width=W;\n        cv.height=H;\n        var ctx=cv.getContext('2d');\n        \n        var maskW=mask.width;\n        var maskH=mask.height;\n        var textW=texture.width;\n        var textH=texture.height;\n        var tmp = document.createElement('canvas');\n        ctx.globalCompositeOperation='or';\n        \n        var y=0;\n        for (var i=0; y<=(H+clipH/2);i++){\n            var x=0;\n            for (var j=0; x<=(W+clipW/2);j++){\n                tmp.width=clipW; tmp.height=clipH;\n                ctxTmp=tmp.getContext('2d');\n                ctxTmp.globalCompositeOperation='xor';\n                ctxTmp.drawImage(texture, Math.random()*(textW-clipW),Math.random()*(textH-clipH),clipW,clipH,0,0,clipW,clipH);\n                ctxTmp.drawImage(mask,0,0,clipW,clipH);\n                ctx.drawImage(tmp,x-clipW/2,y-clipH/2,clipW,clipH);\n                x+=clipW-borderFact*clipW;\n            }\n            y+=clipH-borderFact*clipH;\n        }\n        return cv;\n    }\n\t\n\t\t\n\t\t\t\n\t\n\t// Reducing the promo frame which was overflowing the board screen\n\tView.Game.cbPromoSize = 1100;\n\t\n\t// extending fairy pieces with some musketeer new pieces\n\tView.Game.cbFairyWTamerlanePieceStyle3D = $.extend(true,{},View.Game.cbFairyPieceStyle3D,{\t\n\t\t\t\t\n\t});\n\t\n\tView.Game.cbDefineView = function() {\n        \n        var wtamerlaneBoardDelta = {\n\t\t\tnotationMode: \"out\",\n\t\t\t//notationDebug: true,\n\t\t}\n\n\t\twtamerlaneBoardDelta3d = $.extend(true,{},wtamerlaneBoardDelta,\n\t\t\t{\n\t\t\t\t/*'colorFill' : {\t\t \n\t\t\t\t\t\".\": \"#575b36\", // \"rgba(180,213,80,.3)\",\n\t\t\t\t\t\"#\": \"#474b36\", // \"black\" cells\n\t\t\t\t\t\" \": \"rgba(0,0,0,0)\",\n\t\t\t\t},*/\n\t\t\t\t'colorFill' : {\n\t\t\t\t\t\"#\": \"rgba(204,40,0,1)\", \n\t\t\t\t\t\".\": \"rgba(180,180,0,1)\", \n\t\t\t\t},\n\t\t\t\t'texturesImg' : {\n\t\t\t\t\t'crackles': '/res/images/crackles.jpg',\n\t\t\t\t\t'tiler': '/res/images/tileralpha.png',\n\t\t\t\t},\n\t\t\t\t'3D':true,\n\t\t\t\t'margins' : {x:.47,y:.47},\n\t\t\t\t'extraChannels':[\n\t\t\t\t\t'bump'\n\t\t\t\t],\n\t\t\t\tpaintCell: function(spec,ctx,images,channel,cellType,xCenter,yCenter,cx,cy) {\n\t\t\n\t\t\t\t\tvar tW=images['crackles'].width;\n\t\t\t\t\tvar tH=images['crackles'].height;\n\t\t\t\t\tvar tClipCx=200;\n\t\t\t\t\tvar tClipCy=200;\n\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\n\t\t\t\t\tctx.fillStyle=\"#000000\";\n\t\t\t\t\tctx.fillRect(xCenter-cx/2,yCenter-cy/2,cx,cy);\n\t\t\t\t\t\n\t\t\t\t\tif(channel==\"bump\"){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\n\t\t\t\t\tcx=.98*cx;\n\t\t\t\t\tcy=.98*cy;\n\t\t\t\t\t\n\t\t\t\t\tctx.save();\n\t\t\n\t\t\t\t\t\n\t\t\t\t\tctx.strokeStyle = \"rgba(0,0,0,1)\";\n\t\t\t\t\tctx.lineWidth = 50;\n\t\t\t\t\tif (channel=='diffuse')\n\t\t\t\t\t\tctx.fillStyle=spec.colorFill[cellType];\n\t\t\t\t\telse\n\t\t\t\t\t\tctx.fillStyle=0xffffff;\n\t\t\t\t\tctx.fillRect(xCenter-cx/2,yCenter-cy/2,cx,cy);\n\t\t\t\t\n\t\t\t\t\tctx.globalCompositeOperation = 'multiply';\n\t\t\t\t\tctx.drawImage(images['crackles'],\n\t\t\t\t\t\tMath.random()*(tW-tClipCx),Math.random()*(tH-tClipCy),tClipCx,tClipCy,\n\t\t\t\t\t\txCenter-cx/2,yCenter-cy/2,cx,cy);\n\t\t\t\t\tctx.restore();\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tpaintBackground: function(spec,ctx,images,channel,bWidth,bHeight) {\n\t\t\t\t\n\t\t\t\t\t\tctx.save();\n\t\t\t\t\t\tctx.fillStyle=\"#ffffff\";\n\t\t\t\t\t\tif (channel=='diffuse')\n\t\t\t\t\t\t\tctx.fillStyle=\"#BA784A\";\n\t\t\t\t\t\t\t//ctx.fillStyle=\"#cc6600\";\n\t\t\t\t\t\tvar cSize = this.cbCSize(spec);\n\t\t\t\t\t\tctx.fillRect(-bWidth/2,-bHeight/2,bWidth,bHeight);\n\t\t\t\t\t\tvar textureCanvas=createTexturedPatternCanvas(1200,800,images['crackles'],200,200,images['tiler'],.3);\n\t\t\t\t\t\tctx.globalCompositeOperation='multiply';\n\t\t\t\t\t\tctx.drawImage(textureCanvas,-bWidth/2,-bHeight/2,bWidth,bHeight);\n\t\t\t\t\t\tctx.restore();\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\n\t\twtamerlaneBoardDelta2d = $.extend(true,{},wtamerlaneBoardDelta, \n\t\t\t{\n\t\t\t\t'colorFill' : {\t\t \n\t\t\t\t\t\".\": \"#ffffc0\", // \"white\" cells\n\t\t\t\t\t\"#\": \"#8F976D\", // \"black\" cells\n\t\t\t\t\t\" \": \"rgba(0,0,0,0)\",\n\t\t\t\t},\n\t\t\t\t'texturesImg' : {}, // to avoid default wood texture\n\t\t\t\t'margins' : {x:.47,y:.47},\n\t\t\t\t/*'colorFill' : {\n\t\t\t\t\t\".\": \"rgba(224,50,0,1)\", \n\t\t\t\t\t\"#\": \"rgba(220,220,0,1)\", \n\t\t\t\t},*/\t\t\t\t\t\n\t\t\t}\n\t\t);\n\t\t\n\t\tvar wtamerlaneBoard3d = $.extend(true,{},this.cbGridBoardClassic3DMargin,wtamerlaneBoardDelta3d);\n\t\tvar wtamerlaneBoard2d = $.extend(true,{},this.cbGridBoardClassic2DMargin,wtamerlaneBoardDelta2d);\n\t\t\n\t\treturn {\n\t\t\tcoords: {\n\t\t\t\t\"2d\": this.cbGridBoard.coordsFn.call(this,wtamerlaneBoard2d),\n\t\t\t\t\"3d\": this.cbGridBoard.coordsFn.call(this,wtamerlaneBoard3d),\n\t\t\t},\n\t\t\tboardLayout: [\n\t      \t\t\".#.#.#.#.#.\",\n\t      \t\t\"#.#.#.#.#.#\",\n\t      \t\t\".#.#.#.#.#.\",\n\t      \t\t\"#.#.#.#.#.#\",\n\t      \t\t\".#.#.#.#.#.\",\n\t      \t\t\"#.#.#.#.#.#\",\n\t      \t\t\".#.#.#.#.#.\",\n\t      \t\t\"#.#.#.#.#.#\",\n\t      \t\t\".#.#.#.#.#.\",\n\t      \t\t\"#.#.#.#.#.#\",\n\t      \t\t\".#.#.#.#.#.\",\n\t\t\t],\n\t\t\tboard: {\n\t\t\t\t\"2d\": {\n\t\t\t\t\tdraw: this.cbDrawBoardFn(wtamerlaneBoard2d),\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t},\n\t\t\t\t\"3d\": {\n\t\t\t\t\tdisplay: this.cbDisplayBoardFn(wtamerlaneBoard3d),\t\t\t\t\t\n\t\t\t\t},\n\t\t\t},\n\t\t\tclicker: {\n\t\t\t\t\"2d\": {\n\t\t\t\t\twidth: 1018.1818181818,\n\t\t\t\t\theight: 1018.1818181818,\n\t\t\t\t},\n\t\t\t\t\"3d\": {\n\t\t\t\t\tscale: [0.65454545454545,0.65454545454545,0.65454545454545],\n\t\t\t\t},\n\t\t\t},\n\t\t\tpieces: this.cbFairyPieceStyle({\t\n\t\t\t\t\"default\": {\n\t\t\t\t\t\"2d\": {\n\t\t\t\t\t\twidth: 945.45454545455,\n\t\t\t\t\t\theight: 945.45454545455,\t\n\t\t\t\t\t},\t\t\t\n\t\t\t\t\t\"3d\": {\n\t\t\t\t\t\tscale: [0.43636363636364,0.43636363636364,0.43636363636364],\n\t\t\t\t\t\tdisplay: this.cbDisplayPieceFn(this.cbFairyWTamerlanePieceStyle3D)\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t\"fr-amazon\" :{\n\t\t\t\t\t\"3d\": {\n\t\t\t\t\t\tscale: [0.52363636363636,0.52363636363636,0.52363636363636],\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t}),\n\t\t};\n\t}\n\n\t/* Make the knight jump when moving */\n\tView.Board.cbMoveMidZ = function(aGame,aMove,zFrom,zTo) {\n\t\tvar geo=aGame.cbVar.geometry;\n\t\tvar dx=Math.abs(geo.C(aMove.t)-geo.C(aMove.f));\n\t\tvar dy=Math.abs(geo.R(aMove.t)-geo.R(aMove.f));\t\t\t\t\t\n\t\tif((\"_N_E_J_\".indexOf(\"_\"+aMove.a+\"_\")>=0) && (aGame.g.distGraph[aMove.f][aMove.t]>1))\n\t\t\treturn Math.max(zFrom,zTo)+2000;\n\t\t/*else if((\"__\".indexOf(\"_\"+aMove.a+\"_\")>=0) && dx!=dy && dx!=0 && dy!=0)\n\t\t\treturn Math.max(zFrom,zTo)+2000;*/\n\t\telse if((\"_C_W_\".indexOf(\"_\"+aMove.a+\"_\")>=0) && aMove.c != null)\n\t\t\treturn Math.max(zFrom,zTo)+2000;\n\t\telse\n\t\t\treturn (zFrom+zTo)/2;\n\t}\n\n})();\n"],"file":"wild-tamerlane-chess-view.js"}
{"version":3,"names":[],"mappings":"","sources":["makruk-model.js"],"sourcesContent":["\n(function() {\n\t\n\tvar geometry = Model.Game.cbBoardGeometryGrid(8,8);\n\t\n\tModel.Game.cbDefine = function() {\n\t\t\n\t\treturn {\n\t\t\t\n\t\t\tgeometry: geometry,\n\t\t\t\n\t\t\tpieceTypes: {\n\n\t\t\t\t0: {\n\t\t\t\t\tname: 'pawn-w',\n\t\t\t\t\taspect: 'mk-pawn',\n\t\t\t\t\tgraph: this.cbPawnGraph(geometry,1),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tinitial: [{s:1,p:16},{s:1,p:17},{s:1,p:18},{s:1,p:19},{s:1,p:20},{s:1,p:21},{s:1,p:22},{s:1,p:23}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t1: {\n\t\t\t\t\tname: 'pawn-b',\n\t\t\t\t\taspect: 'mk-pawn',\n\t\t\t\t\tgraph: this.cbPawnGraph(geometry,-1),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tinitial: [{s:-1,p:40},{s:-1,p:41},{s:-1,p:42},{s:-1,p:43},{s:-1,p:44},{s:-1,p:45},{s:-1,p:46},{s:-1,p:47}],\n\t\t\t\t},\n\n\t\t\t\t2: {\n\t\t\t\t\tname: 'horse',\n\t\t\t\t\taspect: 'mk-knight',\n\t\t\t\t\tgraph: this.cbKnightGraph(geometry),\n\t\t\t\t\tvalue: 3.5,\n\t\t\t\t\tabbrev: 'N',\n\t\t\t\t\tinitial: [{s:1,p:1},{s:1,p:6},{s:-1,p:57},{s:-1,p:62}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t3: {\n\t\t\t\t\tname: 'khon-w',\n\t\t\t\t\taspect: 'mk-bishop',\n\t\t\t\t\tgraph: this.cbSilverGraph(geometry,1),\n\t\t\t\t\tvalue: 3,\n\t\t\t\t\tabbrev: 'B',\n\t\t\t\t\tinitial: [{s:1,p:2},{s:1,p:5}],\n\t\t\t\t},\n\n\t\t\t\t4: {\n\t\t\t\t\tname: 'khon-b',\n\t\t\t\t\taspect: 'mk-bishop',\n\t\t\t\t\tgraph: this.cbSilverGraph(geometry,-1),\n\t\t\t\t\tvalue: 3,\n\t\t\t\t\tabbrev: 'B',\n\t\t\t\t\tinitial: [{s:-1,p:58},{s:-1,p:61}],\n\t\t\t\t},\n\n\t\t\t\t5: {\n\t\t\t\t\tname: 'rook',\n\t\t\t\t\taspect: 'mk-rook',\n\t\t\t\t\tgraph: this.cbRookGraph(geometry),\n\t\t\t\t\tvalue: 5,\n\t\t\t\t\tabbrev: 'R',\n\t\t\t\t\tinitial: [{s:1,p:0},{s:1,p:7},{s:-1,p:56},{s:-1,p:63}],\n\t\t\t\t\tcastle: true,\n\t\t\t\t},\n\n\t\t\t\t6: {\n\t\t\t\t\tname: 'met',\n\t\t\t\t\taspect: 'mk-queen',\n\t\t\t\t\tgraph: this.cbFersGraph(geometry),\n\t\t\t\t\tvalue: 2,\n\t\t\t\t\tabbrev: 'Q',\n\t\t\t\t\tinitial: [{s:1,p:4},{s:-1,p:59}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t7: {\n\t\t\t\t\tname: 'king',\n\t\t\t\t\taspect: 'mk-king',\n\t\t\t\t\tisKing: true,\n\t\t\t\t\tgraph: this.cbKingGraph(geometry),\n\t\t\t\t\tabbrev: 'K',\n\t\t\t\t\tinitial: [{s:1,p:3},{s:-1,p:60}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t},\n\t\t\t\n\t\t\tevaluate: function(aGame,evalValues,material) {\n\t\t\t\tvar $this=this;\n\t\t\t\t// implement counting rule\n\t\t\t\tfunction Count(side) {\n\t\t\t\t\tvar maxMoves=64;\n\t\t\t\t\tvar piecesLeft=material[side].count;\n\t\t\t\t\tif(piecesLeft[5]==2)\n\t\t\t\t\t\tmaxMoves=8;\n\t\t\t\t\telse if(piecesLeft[5]==1)\n\t\t\t\t\t\tmaxMoves=16;\n\t\t\t\t\telse {\n\t\t\t\t\t\tif(piecesLeft[side==1?3:4]==2)\n\t\t\t\t\t\t\tmaxMoves=22;\n\t\t\t\t\t\telse if(piecesLeft[side==1?3:4]==1)\n\t\t\t\t\t\t\tmaxMoves=44;\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tif(piecesLeft[2]==2)\n\t\t\t\t\t\t\t\tmaxMoves=32;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif($this.noCaptCount>=maxMoves*2) {\n\t\t\t\t\t\t$this.mFinished=true;\n\t\t\t\t\t\t$this.mWinner=JocGame.DRAW;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(material[1].count[0]==0) // no white pawn left\n\t\t\t\t\tCount(-1);\n\t\t\t\tif(material[-1].count[1]==0) // no black pawn left\n\t\t\t\t\tCount(1);\n\t\t\t},\n\t\t\t\n\t\t\tpromote: function(aGame,piece,move) {\n\t\t\t\tif(piece.t==0 && geometry.R(move.t)==5)\n\t\t\t\t\treturn [6];\n\t\t\t\telse if(piece.t==1 && geometry.R(move.t)==2)\n\t\t\t\t\treturn [6];\n\t\t\t\treturn [];\n\t\t\t},\n\t\t\t\n\t\t};\n\t}\n\t\n})();"],"file":"makruk-model.js"}
{"version":3,"names":[],"mappings":"","sources":["mccooey-model.js"],"sourcesContent":["\n(function() {\n\t\n\tvar posNames = {\n\t\t2:'a1',13:'b1',23:'c1',34:'d1',44:'e1',55:'f1',66:'g1',78:'h1',89:'i1',101:'k1',112:'l1',\n\t\t3:'a2',14:'b2',24:'c2',35:'d2',45:'e2',56:'f2',67:'g2',79:'h2',90:'i2',102:'k2',113:'l2',\n\t\t4:'a3',15:'b3',25:'c3',36:'d3',46:'e3',57:'f3',68:'g3',80:'h3',91:'i3',103:'k3',114:'l3',\n\t\t5:'a4',16:'b4',26:'c4',37:'d4',47:'e4',58:'f4',69:'g4',81:'h4',92:'i4',104:'k4',115:'l4',\n\t\t6:'a5',17:'b5',27:'c5',38:'d5',48:'e5',59:'f5',70:'g5',82:'h5',93:'i5',105:'k5',116:'l5',\n\t\t7:'a6',18:'b6',28:'c6',39:'d6',49:'e6',60:'f6',71:'g6',83:'h6',94:'i6',106:'k6',117:'l6',\n\t\t       19:'b7',29:'c7',40:'d7',50:'e7',61:'f7',72:'g7',84:'h7',95:'i7',107:'k7',\n\t\t               30:'c8',41:'d8',51:'e8',62:'f8',73:'g8',85:'h8',96:'i8',\n\t\t                       42:'d9',52:'e9',63:'f9',74:'g9',86:'h9',\n\t\t                              53:'e10',64:'f10',75:'g10',\n\t\t                                       65:'f11',\n\t};\n\t\n\tvar geometry = Model.Game.cbBoardGeometryHex([ \n       '     # + . # + .      ',\n       '    + . # + . # +     ',\n       '   . # + . # + . #    ',\n       '  # + . # + . # + .   ',\n       ' + . # + . # + . # +  ',\n       '. # + . # + . # + . # ',\n       ' + . # + . # + . # +  ',\n       '  # + . # + . # + .   ',\n       '   . # + . # + . #    ',\n       '    + . # + . # +     ',\n       '     # + . # + .      ' \n    ],posNames);\n\t\n\tvar promo = {\n\t\t\"1\": { 7:1, 19:1, 30:1, 42:1, 53:1, 65:1, 75:1, 86:1, 96:1, 107:1, 117:1 },\n\t\t\"-1\": { 2:1, 13:1, 23:1, 34:1, 44:1, 55:1, 66:1, 78:1, 89:1, 101:1, 112:1 },\n\t}\n\t\n\t// for each side and position, calculate distance to promotion line\n\tvar distPromo={\t\"1\": {}, \"-1\": {} };\n\tvar distance = geometry.GetDistances();\n\t[\"1\",\"-1\"].forEach(function(side) {\n\t\tfor(var pos in geometry.confine) {\n\t\t\tvar minDist=Infinity;\n\t\t\tfor(var pos1 in promo[side]) {\n\t\t\t\tvar dist=distance[pos][pos1];\n\t\t\t\tif(dist<minDist) {\n\t\t\t\t\tdistPromo[side][pos]=dist;\n\t\t\t\t\tminDist=dist;\n\t\t\t\t}\n\t\t\t}\n\t\t}\t\t\n\t});\n\t\n\tModel.Game.cbDefine = function() {\n\t\t\n\t\treturn {\n\t\t\t\n\t\t\tgeometry: geometry,\n\t\t\t\n\t\t\tpieceTypes: {\n\n\t\t\t\t0: {\n\t\t\t\t\tname: 'pawn-w',\n\t\t\t\t\taspect: 'pawn',\n\t\t\t\t\tgraph: this.cbMCPawnGraph(geometry,1,1),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tinitial: [{s:1,p:58}],\n\t\t\t\t\tepCatch: true,\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t1: {\n\t\t\t\t\tname: 'ipawn-w',\n\t\t\t\t\taspect: 'pawn',\n\t\t\t\t\tgraph: this.cbMCPawnGraph(geometry,1,2),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tinitial: [{s:1,p:23},{s:1,p:35},{s:1,p:46},{s:1,p:68},{s:1,p:79},{s:1,p:89}],\n\t\t\t\t\tepTarget: true,\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t2: {\n\t\t\t\t\tname: 'pawn-b',\n\t\t\t\t\taspect: 'pawn',\n\t\t\t\t\tgraph: this.cbMCPawnGraph(geometry,-1,1),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tinitial: [{s:-1,p:62}],\n\t\t\t\t\tepCatch: true,\n\t\t\t\t},\n\n\t\t\t\t3: {\n\t\t\t\t\tname: 'ipawn-b',\n\t\t\t\t\taspect: 'pawn',\n\t\t\t\t\tgraph: this.cbMCPawnGraph(geometry,-1,2),\n\t\t\t\t\tvalue: 1,\n\t\t\t\t\tabbrev: '',\n\t\t\t\t\tfenAbbrev: 'P',\n\t\t\t\t\tinitial: [{s:-1,p:30},{s:-1,p:41},{s:-1,p:51},{s:-1,p:73},{s:-1,p:85},{s:-1,p:96}],\n\t\t\t\t\tepTarget: true,\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t4: {\n\t\t\t\t\tname: 'knight',\n\t\t\t\t\tgraph: this.cbGLKnightGraph(geometry),\n\t\t\t\t\tvalue: 2.9,\n\t\t\t\t\tabbrev: 'N',\n\t\t\t\t\tinitial: [{s:1,p:45},{s:1,p:67},{s:-1,p:52},{s:-1,p:74}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t5: {\n\t\t\t\t\tname: 'bishop',\n\t\t\t\t\tgraph: this.cbGLBishopGraph(geometry),\n\t\t\t\t\tvalue: 3.1,\n\t\t\t\t\tabbrev: 'B',\n\t\t\t\t\tinitial: [{s:1,p:55},{s:1,p:56},{s:1,p:57},{s:-1,p:65},{s:-1,p:64},{s:-1,p:63}],\n\t\t\t\t},\n\n\t\t\t\t6: {\n\t\t\t\t\tname: 'rook',\n\t\t\t\t\tgraph: this.cbGLRookGraph(geometry),\n\t\t\t\t\tvalue: 5,\n\t\t\t\t\tabbrev: 'R',\n\t\t\t\t\tinitial: [{s:1,p:34},{s:1,p:78},{s:-1,p:42},{s:-1,p:86}],\n\t\t\t\t\tcastle: true,\n\t\t\t\t},\n\n\t\t\t\t7: {\n\t\t\t\t\tname: 'queen',\n\t\t\t\t\tgraph: this.cbGLQueenGraph(geometry),\n\t\t\t\t\tvalue: 9,\n\t\t\t\t\tabbrev: 'Q',\n\t\t\t\t\tinitial: [{s:1,p:44},{s:-1,p:53}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t8: {\n\t\t\t\t\tname: 'king',\n\t\t\t\t\tisKing: true,\n\t\t\t\t\tgraph: this.cbGLKingGraph(geometry),\n\t\t\t\t\tabbrev: 'K',\n\t\t\t\t\tinitial: [{s:1,p:66},{s:-1,p:75}],\n\t\t\t\t},\n\t\t\t\t\n\t\t\t},\n\t\t\t\n\t\t\tpromote: function(aGame,piece,move) {\n\t\t\t\tif(piece.t==1)\n\t\t\t\t\treturn [0];\n\t\t\t\telse if(piece.t==3)\n\t\t\t\t\treturn [2];\n\t\t\t\telse if(piece.t==0 && (move.t in promo[1]))\n\t\t\t\t\treturn [4,5,6,7];\n\t\t\t\telse if(piece.t==2 && (move.t in promo[-1]))\n\t\t\t\t\treturn [4,5,6,7];\n\t\t\t\treturn [];\n\t\t\t},\n\n\t\t\tevaluate: function(aGame,evalValues,material) {\n\t\t\t\t\n\t\t\t\t// check lack of material to checkmate\n\t\t\t\tvar white=material[1].count;\n\t\t\t\tvar black=material[-1].count;\n\t\t\t\tif(!white[0] && !white[1] && !white[4] && !white[5] && !white[6] && !white[7]) { // white king single\n\t\t\t\t\tif(!black[2] && !black[3] && !black[6] && !black[7] && (black[4]+black[5]<2 || black[5]<2)) {\n\t\t\t\t\t\tthis.mFinished=true;\n\t\t\t\t\t\tthis.mWinner=JocGame.DRAW;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(!black[2] && !black[3] && !black[4] && !black[5] && !black[6] && !black[7]) { // black king single\n\t\t\t\t\tif(!white[0] && !white[1] && !white[6] && !white[7] && (white[4]+white[5]<2 || white[5]<2)) {\n\t\t\t\t\t\tthis.mFinished=true;\n\t\t\t\t\t\tthis.mWinner=JocGame.DRAW;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// check 50 moves without capture\n\t\t\t\tif(this.noCaptCount>=100) {\n\t\t\t\t\tthis.mFinished=true;\n\t\t\t\t\tthis.mWinner=JocGame.DRAW;\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// motivate pawns to reach the promotion line\n\t\t\t\tvar distPromo0=aGame.cbUseTypedArrays?new Int8Array(3):[0,0,0];\n\t\t\t\tvar pawns=material[1].byType[0],pawnsLength;\n\t\t\t\tif(pawns) {\n\t\t\t\t\tpawnsLength=pawns.length;\n\t\t\t\t\tfor(var i=0;i<pawnsLength;i++) {\n\t\t\t\t\t\tvar dProm=distPromo[1][pawns[i].p];\n\t\t\t\t\t\tif(dProm>0 && dProm<4)\n\t\t\t\t\t\t\tdistPromo0[dProm-1]++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tpawns=material[-1].byType[2],pawnsLength;\n\t\t\t\tif(pawns) {\n\t\t\t\t\tpawnsLength=pawns.length;\n\t\t\t\t\tfor(var i=0;i<pawnsLength;i++) {\n\t\t\t\t\t\tvar dProm=distPromo[-1][pawns[i].p];\n\t\t\t\t\t\tif(dProm>0 && dProm<4)\n\t\t\t\t\t\t\tdistPromo0[dProm-1]--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(distPromo0[0]!=0)\n\t\t\t\t\tevalValues['distPawnPromo1']=distPromo0[0];\n\t\t\t\tif(distPromo0[1]!=0)\n\t\t\t\t\tevalValues['distPawnPromo2']=distPromo0[1];\n\t\t\t\tif(distPromo0[2]!=0)\n\t\t\t\t\tevalValues['distPawnPromo3']=distPromo0[2];\n\t\t\t\t\n\t\t\t\t// motivate knights and bishops to deploy early\n\t\t\t\tvar minorPiecesMoved=0;\n\t\t\t\tfor(var t=4;t<=5;t++)\n\t\t\t\t\tfor(var s=1;s>=-1;s-=2) {\n\t\t\t\t\t\tvar pieces=material[s].byType[t];\n\t\t\t\t\t\tif(pieces)\n\t\t\t\t\t\t\tfor(var i=0;i<pieces.length;i++)\n\t\t\t\t\t\t\t\tif(pieces[i].m)\n\t\t\t\t\t\t\t\t\tminorPiecesMoved+=s;\n\t\t\t\t\t}\n\t\t\t\tif(minorPiecesMoved!=0) {\n\t\t\t\t\tevalValues['minorPiecesMoved']=minorPiecesMoved;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t};\n\t}\n\t\n})();\n"],"file":"mccooey-chess-model.js"}
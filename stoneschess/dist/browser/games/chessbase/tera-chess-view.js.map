{"version":3,"names":[],"mappings":"","sources":["terachess-view.js"],"sourcesContent":["/*\n *\n *\n *\n * authors: jerome choain\n *\n */\n\n(function() {\n\n    function createTexturedPatternCanvas(W,H,texture,clipW,clipH,mask,borderFact){\n    \t// borderFact is the percentage (/100) of the mask transition overlay border : ex 30% => .3\n        var cv = document.createElement('canvas');\n        cv.width=W;\n        cv.height=H;\n        var ctx=cv.getContext('2d');\n\n        var maskW=mask.width;\n        var maskH=mask.height;\n        var textW=texture.width;\n        var textH=texture.height;\n        var tmp = document.createElement('canvas');\n        ctx.globalCompositeOperation='or';\n\n        var y=0;\n        for (var i=0; y<=(H+clipH/2);i++){\n            var x=0;\n            for (var j=0; x<=(W+clipW/2);j++){\n                tmp.width=clipW; tmp.height=clipH;\n                ctxTmp=tmp.getContext('2d');\n                ctxTmp.globalCompositeOperation='xor';\n                ctxTmp.drawImage(texture, Math.random()*(textW-clipW),Math.random()*(textH-clipH),clipW,clipH,0,0,clipW,clipH);\n                ctxTmp.drawImage(mask,0,0,clipW,clipH);\n                ctx.drawImage(tmp,x-clipW/2,y-clipH/2,clipW,clipH);\n                x+=clipW-borderFact*clipW;\n            }\n            y+=clipH-borderFact*clipH;\n        }\n        return cv;\n    }\n\n\n\n\n\t// Reducing the promo frame which was overflowing the board screen\n\tView.Game.cbPromoSize = 1100;\n\n\t// extending fairy pieces with some musketeer new pieces\n\tView.Game.cbFairyTerachessPieceStyle3D = $.extend(true,{},View.Game.cbFairyPieceStyle3D,{\n\t});\n\n\tView.Game.cbDefineView = function() {\n\n        var terachessBoardDelta = {\n\t\t\tnotationMode: \"out\",\n\t\t\t//notationDebug: true,\n\t\t}\n\t\t\n\t\tterachessBoardDelta3d = $.extend(true,{},terachessBoardDelta,\n\t\t\t{\n\t\t\t\t/*'colorFill' : {\n\t\t\t\t\t\".\": \"#575b36\", // \"rgba(180,213,80,.3)\",\n\t\t\t\t\t\"#\": \"#474b36\", // \"black\" cells\n\t\t\t\t\t\" \": \"rgba(0,0,0,0)\",\n\t\t\t\t},*/\n\t\t\t\t'colorFill' : {\n\t\t\t\t\t\"#\": \"rgba(204,40,0,1)\",\n\t\t\t\t\t\".\": \"rgba(180,180,0,1)\",\n\t\t\t\t},\n\t\t\t\t'texturesImg' : {\n\t\t\t\t\t'crackles': '/res/images/crackles.jpg',\n\t\t\t\t\t'tiler': '/res/images/tileralpha.png',\n\t\t\t\t},\n\t\t\t\t'3D':true,\n\t\t\t\t'margins' : {x:.47,y:.47},\n\t\t\t\t'extraChannels':[\n\t\t\t\t\t'bump'\n\t\t\t\t],\n\t\t\t\tpaintCell: function(spec,ctx,images,channel,cellType,xCenter,yCenter,cx,cy) {\n\n\t\t\t\t\tvar tW=images['crackles'].width;\n\t\t\t\t\tvar tH=images['crackles'].height;\n\t\t\t\t\tvar tClipCx=200;\n\t\t\t\t\tvar tClipCy=200;\n\n\n\n\t\t\t\t\tctx.fillStyle=\"#000000\";\n\t\t\t\t\tctx.fillRect(xCenter-cx/2,yCenter-cy/2,cx,cy);\n\n\t\t\t\t\tif(channel==\"bump\"){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tcx=.98*cx;\n\t\t\t\t\tcy=.98*cy;\n\n\t\t\t\t\tctx.save();\n\n\n\t\t\t\t\tctx.strokeStyle = \"rgba(0,0,0,1)\";\n\t\t\t\t\tctx.lineWidth = 50;\n\t\t\t\t\tif (channel=='diffuse')\n\t\t\t\t\t\tctx.fillStyle=spec.colorFill[cellType];\n\t\t\t\t\telse\n\t\t\t\t\t\tctx.fillStyle=0xffffff;\n\t\t\t\t\tctx.fillRect(xCenter-cx/2,yCenter-cy/2,cx,cy);\n\n\t\t\t\t\tctx.globalCompositeOperation = 'multiply';\n\t\t\t\t\tctx.drawImage(images['crackles'],\n\t\t\t\t\t\tMath.random()*(tW-tClipCx),Math.random()*(tH-tClipCy),tClipCx,tClipCy,\n\t\t\t\t\t\txCenter-cx/2,yCenter-cy/2,cx,cy);\n\t\t\t\t\tctx.restore();\n\t\t\t\t},\n\n\t\t\t\tpaintBackground: function(spec,ctx,images,channel,bWidth,bHeight) {\n\n\t\t\t\t\t\tctx.save();\n\t\t\t\t\t\tctx.fillStyle=\"#ffffff\";\n\t\t\t\t\t\tif (channel=='diffuse')\n\t\t\t\t\t\t\tctx.fillStyle=\"#BA784A\";\n\t\t\t\t\t\t\t//ctx.fillStyle=\"#cc6600\";\n\t\t\t\t\t\tvar cSize = this.cbCSize(spec);\n\t\t\t\t\t\tctx.fillRect(-bWidth/2,-bHeight/2,bWidth,bHeight);\n\t\t\t\t\t\tvar textureCanvas=createTexturedPatternCanvas(1200,800,images['crackles'],200,200,images['tiler'],.3);\n\t\t\t\t\t\tctx.globalCompositeOperation='multiply';\n\t\t\t\t\t\tctx.drawImage(textureCanvas,-bWidth/2,-bHeight/2,bWidth,bHeight);\n\t\t\t\t\t\tctx.restore();\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\n\t\tterachessBoardDelta2d = $.extend(true,{},terachessBoardDelta,\n\t\t\t{\n\t\t\t\t'colorFill' : {\n\t\t\t\t\t\".\": \"#ffffc0\", // \"white\" cells\n\t\t\t\t\t\"#\": \"#8F976D\", // \"black\" cells\n\t\t\t\t\t\" \": \"rgba(0,0,0,0)\",\n\t\t\t\t},\n\t\t\t\t'texturesImg' : {}, // to avoid default wood texture\n\t\t\t\t'margins' : {x:.47,y:.47},\n\t\t\t\t/*'colorFill' : {\n\t\t\t\t\t\".\": \"rgba(224,50,0,1)\",\n\t\t\t\t\t\"#\": \"rgba(220,220,0,1)\",\n\t\t\t\t},*/\n\t\t\t}\n\t\t);\n\n\t\tvar terachessBoard3d = $.extend(true,{},this.cbGridBoardClassic3DMargin,terachessBoardDelta3d);\n\t\tvar terachessBoard2d = $.extend(true,{},this.cbGridBoardClassic2DMargin,terachessBoardDelta2d);\n\n\t\treturn {\n\t\t\tcoords: {\n\t\t\t\t\"2d\": this.cbGridBoard.coordsFn.call(this,terachessBoard2d),\n\t\t\t\t\"3d\": this.cbGridBoard.coordsFn.call(this,terachessBoard3d),\n\t\t\t},\n\t\t\tboardLayout: [\n\t      \t\t\".#.#.#.#.#.#.#.#\",\n\t      \t\t\"#.#.#.#.#.#.#.#.\",\n\t      \t\t\".#.#.#.#.#.#.#.#\",\n\t      \t\t\"#.#.#.#.#.#.#.#.\",\n\t      \t\t\".#.#.#.#.#.#.#.#\",\n\t      \t\t\"#.#.#.#.#.#.#.#.\",\n\t      \t\t\".#.#.#.#.#.#.#.#\",\n\t      \t\t\"#.#.#.#.#.#.#.#.\",\n\t      \t\t\".#.#.#.#.#.#.#.#\",\n\t      \t\t\"#.#.#.#.#.#.#.#.\",\n\t      \t\t\".#.#.#.#.#.#.#.#\",\n\t      \t\t\"#.#.#.#.#.#.#.#.\",\n\t      \t\t\".#.#.#.#.#.#.#.#\",\n\t      \t\t\"#.#.#.#.#.#.#.#.\",\n\t      \t\t\".#.#.#.#.#.#.#.#\",\n\t      \t\t\"#.#.#.#.#.#.#.#.\",\n\t\t\t],\n\t\t\tboard: {\n\t\t\t\t\"2d\": {\n\t\t\t\t\tdraw: this.cbDrawBoardFn(terachessBoard2d),\n\t\t\t\t},\n\t\t\t\t\"3d\": {\n\t\t\t\t\tdisplay: this.cbDisplayBoardFn(terachessBoard3d),\n\t\t\t\t},\n\t\t\t},\n\t\t\tclicker: {\n\t\t\t\t\"2d\": {\n\t\t\t\t\twidth: 700,\n\t\t\t\t\theight: 700,\n\t\t\t\t},\n\t\t\t\t\"3d\": {\n\t\t\t\t\tscale: [0.45,0.45,0.45],\n\t\t\t\t},\n\t\t\t},\n\t\t\tpieces: this.cbFairyPieceStyle({\n\t\t\t\t\"default\": {\n\t\t\t\t\t\"2d\": {\n\t\t\t\t\t\twidth: 650,\n\t\t\t\t\t\theight: 650,\n\t\t\t\t\t},\n\t\t\t\t\t\"3d\": {\n\t\t\t\t\t\tscale: [0.3,0.3,0.3],\n\t\t\t\t\t\tdisplay: this.cbDisplayPieceFn(this.cbFairyTerachessPieceStyle3D)\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t\"fr-amazon\" :{\n\t\t\t\t\t\"3d\": {\n\t\t\t\t\t\t\t\t\t\t\t\tscale: [0.36,0.36,0.36],\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"fr-star\" :{\n\t\t\t\t\t\t\"3d\":{scale:[0.36,0.36,0.36]},\n\t\t\t\t\t},\n\t\t\t\t\"fr-rhino\" :{\n\t\t\t\t\t\t\"3d\":{scale:[0.24,0.24,0.24]},\n\t\t\t\t},\n\t\t\t\t\"fr-bull\" :{\n\t\t\t\t\t\t\"3d\":{scale:[0.21,0.21,0.21]},\n\t\t\t\t},\n\t\t\t\t\"fr-antelope\" :{\n\t\t\t\t\t\t\"3d\":{scale:[0.24,0.24,0.24]},\n\t\t\t\t},\n\t\t\t}),\n\t\t};\n\t}\n\n\t/* Make the jumps */\n\tView.Board.cbMoveMidZ = function(aGame,aMove,zFrom,zTo) {\n\t\tvar geo=aGame.cbVar.geometry;\n\t\tvar dx=Math.abs(geo.C(aMove.t)-geo.C(aMove.f));\n\t\tvar dy=Math.abs(geo.R(aMove.t)-geo.R(aMove.f));\n\t\tif((\"_N_E_D_L_J_T_F_G_S_\".indexOf(\"_\"+aMove.a+\"_\")>=0) && (aGame.g.distGraph[aMove.f][aMove.t]>1))\n\t\t\treturn Math.max(zFrom,zTo)+2000;\n\t\telse if((\"_A_C_M_\".indexOf(\"_\"+aMove.a+\"_\")>=0) && dx!=dy && dx!=0 && dy!=0)\n\t\t\treturn Math.max(zFrom,zTo)+2000;\n\t\telse if((\"_Z_W_\".indexOf(\"_\"+aMove.a+\"_\")>=0) && aMove.c != null)\n\t\t\treturn Math.max(zFrom,zTo)+2000;\n\t\telse\n\t\t\treturn (zFrom+zTo)/2;\n\t}\n\t/*\n\t * View.Board.xdDisplay overriding to prevent displaying black xtra pieces before setup\n\t */\n\tvar SuperViewBoardxdDisplay = View.Board.xdDisplay;\n\tView.Board.xdDisplay = function(xdv, aGame) {\n\t\tvar size = 1060;\n\t\tSuperViewBoardxdDisplay.apply(this,arguments);\n\n\t}\n\n\n\t/*\n\t * View.Game.xdInit overriding to create initial setup gadgets\n\t */\n\tvar SuperViewGameXdInit = View.Game.xdInit;\n\tView.Game.xdInit = function(xdv) {\n\t\tvar size = 1060;\n\t\tvar $this=this;\n\t\tSuperViewGameXdInit.apply(this,arguments);\n\t}\n})();\n"],"file":"tera-chess-view.js"}
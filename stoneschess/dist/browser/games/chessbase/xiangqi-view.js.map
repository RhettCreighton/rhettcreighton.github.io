{"version":3,"names":[],"mappings":"","sources":["xiangqi-board-view.js"],"sourcesContent":["(function() {\n\t\n\tView.Game.cbXiangqiBoard = $.extend({},View.Game.cbGridBoardClassic,{\n\t\t'colorFill' : {\t\t\n\t\t\t\".\": \"rgba(0,0,0,0)\", \n\t\t},\n\t\t\n\t\t'texturesImg' : {\n\t\t\t'boardBG' : '/res/xiangqi/wood2.jpg',\n\t\t\t'boarddeco1': '/res/xiangqi/decoration-cross.png',\n\t\t},\n\t\t\n\t\tpaintCell: function(spec,ctx,images,channel,cellType,xCenter,yCenter,cx,cy) {\n\t\t},\n\n\t\tpaintBackground: function(spec,ctx,images,channel,bWidth,bHeight) {\n\t\t\tif (channel=='diffuse')\n\t\t\t\tctx.drawImage(images['boardBG'],-bWidth/2,-bHeight/2,bWidth,bHeight);\t\t\t\t\n\t\t},\t\t\n\t\t\n\t\tpaintLines: function(spec,ctx,images,channel) {\n\n\t\t\tvar $this=this;\n\t\t\t\n\t\t\tvar NBROWS=10, NBCOLS=9;\n\t\t\t\n\t\t\tvar cSize = this.cbCSize(spec);\n\t\t\tvar getCoords=spec.coordsFn(spec);\n\n\t\t\tctx.strokeStyle = \"rgba(0,0,0,1)\";\n\t\t\tctx.lineWidth = 15;\n\t\t\t\n\t\t\tfunction Pos(col,row) {\n\t\t\t\treturn $this.mViewAs==1 ?\n\t\t\t\t\t\tcol+row*NBCOLS :\n\t\t\t\t\t\tNBCOLS*NBROWS-(1+col+row*NBCOLS);\n\t\t\t}\n\t\n\t\t\tfunction JoinPoints(start,end){\n\t\t\t\tvar p0=getCoords.call($this,Pos(start.col,start.row));\n\t\t\t\tvar p1=getCoords.call($this,Pos(end.col,end.row));\n\t\t\t\tctx.beginPath();\n\t\t\t\tctx.moveTo(p0.x,p0.y);\n\t\t\t\tctx.lineTo(p1.x,p1.y);\n\t\t\t\tctx.stroke();\n\t\t\t}\n\t\t\t\n\t\t\tfunction PositionDecoration(point){\n\t\t\t\tvar p=getCoords.call($this,Pos(point.col,point.row));\t\t\t\t\n\t\t\t\tvar cx=cSize.cx/2;\n\t\t\t\tvar cy=cSize.cy/2;\n\t\t\t\tif(images['boarddeco1']){\n\t\t\t\t\tvar image=images['boarddeco1'];\n\t\t\t\t\tswitch (point.col){\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tctx.drawImage(image,p.x-cx/2,p.y-cy/2,cx,cy);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 0:\n\t\t\t\t\t\t\tctx.drawImage(image,image.width/2,0,image.width/2,image.height,p.x,p.y-cy/2,cx/2,cy);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 8:\n\t\t\t\t\t\t\tctx.drawImage(image,0,0,image.width/2,image.height,p.x-cx/2,p.y-cy/2,cx/2,cy);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\t\t\t\t\n\t\t\t}\n\n\t\t\t/*\n\t\t\tif (channel=='diffuse'){\n\t\t\t\tctx.fillStyle=\"rgba(50,0,0,0.5)\";\n\t\t\t\tctx.fillRect(-game.JOCLYFIELDSIZE/2,-game.JOCLYFIELDSIZE/2,game.JOCLYFIELDSIZE,game.JOCLYFIELDSIZE);\n\t\t\t}\n\t\t\t*/\n\t\n\t\t\tvar topleft=getCoords.call($this,Pos(0,NBROWS-1));\n\t\t\tctx.save();\n\t\t\tctx.lineWidth = 60;\n\t\t\tctx.fillStyle=\"rgba(231,208,167,0.0)\";\n\t\t\t//ctx.fillStyle=\"rgba(0,0,0,0.3)\";\n\t\t\t//ctx.globalCompositeOperation = 'multiply';\n\t\t\tctx.rect(topleft.x,topleft.y,\n\t\t\t\t(NBCOLS-1)*cSize.cx,\n\t\t\t\t(NBROWS-1)*cSize.cy);\n\t\t\tctx.fill();\n\t\t\tctx.stroke();\n\t\t\tctx.restore();\n\t\n\t\t\tfor(var row=1;row<NBROWS;row++){\n\t\t\t\tvar pos=Pos(0,row);\n\t\t\t\tvar coords=getCoords.call($this,pos);\n\t\t\t\tctx.strokeRect(coords.x, coords.y, (NBCOLS-1)*cSize.cx, cSize.cy);\n\t\t\t}\n\t\t\tfor (var row=4;row<NBROWS;row+=5){\n\t\t\t\tfor(var col=0;col<(NBCOLS-1);col++){\n\t\t\t\t\tvar pos=Pos(col,row);\n\t\t\t\t\tvar coords=getCoords.call($this,pos);\n\t\t\t\t\tctx.strokeRect(coords.x, coords.y, cSize.cx, 4*cSize.cy);\n\t\t\t\t}\n\t\t\t}\n\t\t\tJoinPoints({col:3,row:0},{col:5,row:2});\n\t\t\tJoinPoints({col:5,row:0},{col:3,row:2});\n\t\t\tJoinPoints({col:3,row:9},{col:5,row:7});\n\t\t\tJoinPoints({col:5,row:9},{col:3,row:7});\n\t\t\t\n\t\t\tPositionDecoration({col:1,row:2});\n\t\t\tPositionDecoration({col:7,row:2});\n\t\t\tPositionDecoration({col:1,row:7});\n\t\t\tPositionDecoration({col:7,row:7});\n\t\t\tfor (var col=0; col < 9 ; col+=2){\t\t\t\t\n\t\t\t\tPositionDecoration({col:col,row:3});\n\t\t\t\tPositionDecoration({col:col,row:6});\n\t\t\t}\n\t\t},\n\t});\n\t\n\tView.Game.cbXiangqiBoard3DMargin = $.extend({},View.Game.cbXiangqiBoard,{\n\t\t'3D':true,\n\t\t'margins' : {x:.35,y:.35},\n\t\t'extraChannels':[\n\t\t\t'bump'\n\t\t],\n\t});\n\t\n\tView.Game.cbXiangqiBoard2DMargin = $.extend({},View.Game.cbXiangqiBoard,{\n\t\t'margins' : {x:.35,y:.35},\n\t});\n\t\n\tView.Game.cbXiangqiBoard2DNoMargin = $.extend({},View.Game.cbXiangqiBoard,{\n\t\t'margins' : {x:0.0,y:0.0},\n\t});\n\t\n})();"],"file":"xiangqi-view.js"}